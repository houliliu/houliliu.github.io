<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker 三剑客 Compose | 温柔一刀</title>
    <meta name="description" content="">
    <link rel="icon" href="/img/logo.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.a8fadcfc.css" as="style"><link rel="preload" href="/assets/js/app.3295d756.js" as="script"><link rel="preload" href="/assets/js/8.beb2bf5d.js" as="script"><link rel="preload" href="/assets/js/10.38c467ad.js" as="script"><link rel="prefetch" href="/assets/js/11.d4321d37.js"><link rel="prefetch" href="/assets/js/12.0aa7141a.js"><link rel="prefetch" href="/assets/js/13.6bb7e66f.js"><link rel="prefetch" href="/assets/js/14.58ed4118.js"><link rel="prefetch" href="/assets/js/15.61ef56ff.js"><link rel="prefetch" href="/assets/js/16.befdde1c.js"><link rel="prefetch" href="/assets/js/17.cf067eab.js"><link rel="prefetch" href="/assets/js/18.53979078.js"><link rel="prefetch" href="/assets/js/19.99855ec8.js"><link rel="prefetch" href="/assets/js/2.50cffe61.js"><link rel="prefetch" href="/assets/js/20.9321d797.js"><link rel="prefetch" href="/assets/js/21.302abdf0.js"><link rel="prefetch" href="/assets/js/22.cf1803f0.js"><link rel="prefetch" href="/assets/js/23.9a7e9698.js"><link rel="prefetch" href="/assets/js/24.1916c860.js"><link rel="prefetch" href="/assets/js/3.d4df4c83.js"><link rel="prefetch" href="/assets/js/4.eb49bfe2.js"><link rel="prefetch" href="/assets/js/5.2a57351f.js"><link rel="prefetch" href="/assets/js/6.06fba2c1.js"><link rel="prefetch" href="/assets/js/7.9ad3fe6f.js"><link rel="prefetch" href="/assets/js/9.d959ce65.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a8fadcfc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpeg" alt="温柔一刀" class="logo"> <span class="site-name can-hide">温柔一刀</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/ponder/" class="nav-link">思考</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/share/" class="nav-link">分享</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/5afc74a26f09" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/houliliu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/rea-leaf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav> <div style="margin-left:20px;margin-right:20px;">
   音乐
  <div role="switch" class="el-switch"><input type="checkbox" name="" true-value="true" class="el-switch__input"><!----><span class="el-switch__core" style="width:40px;"></span><!----></div> <audio loop="loop"><source src="/assets/media/love.71191943.mp3" type="audio/mpeg"></audio></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/ponder/" class="nav-link">思考</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/share/" class="nav-link">分享</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/5afc74a26f09" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/houliliu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/rea-leaf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Docker 三剑客 Compose</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_1-什么是-docker-compose" class="sidebar-link">1. 什么是 Docker Compose</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_2-docker-compose-简介" class="sidebar-link">2. Docker Compose 简介</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_3-docker-compose-安装与卸载" class="sidebar-link">3. Docker Compose 安装与卸载</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_4-compose常用命令" class="sidebar-link">4. Compose常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_1、build构建项目中的服务容器" class="sidebar-link">1、build	构建项目中的服务容器</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_2、help获得一个命令的帮助" class="sidebar-link">2、help	获得一个命令的帮助</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_3、kill通过发送sigkill信号来强制停止服务容器" class="sidebar-link">3、kill	通过发送SIGKILL信号来强制停止服务容器</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_4、config验证和查看compose文件配置" class="sidebar-link">4、config	验证和查看compose文件配置</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_5、create为服务创建容器" class="sidebar-link">5、create	为服务创建容器</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_6、down停止并删除容器，网络，镜像和数据卷" class="sidebar-link">6、down	停止并删除容器，网络，镜像和数据卷</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_7、exec-在运行的容器中执行一个命令" class="sidebar-link">7、exec 在运行的容器中执行一个命令</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_8、logs-查看服务容器的输出" class="sidebar-link">8、logs 查看服务容器的输出</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_9、pause-暂停一个服务容器" class="sidebar-link">9、pause 暂停一个服务容器</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_10、port-打印某个容器端口所映射的公共端口" class="sidebar-link">10、port 打印某个容器端口所映射的公共端口</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_11、ps-列出项目中目前的所有容器" class="sidebar-link">11、ps 列出项目中目前的所有容器</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_12、pull-拉取服务依赖的镜像" class="sidebar-link">12、pull 拉取服务依赖的镜像</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_13、push-推送服务镜像" class="sidebar-link">13、push 推送服务镜像</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_14、restart-重启项目中的服务" class="sidebar-link">14、restart 重启项目中的服务</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_15、rm-删除所有（停止状态的）服务容器" class="sidebar-link">15、rm 删除所有（停止状态的）服务容器</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_16、run-在指定服务上执行一个命令" class="sidebar-link">16、run 在指定服务上执行一个命令</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_17、scale-设置指定服务运行的容器个数" class="sidebar-link">17、scale 设置指定服务运行的容器个数</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_18、start-启动已经存在的服务容器" class="sidebar-link">18、start 启动已经存在的服务容器</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_19、stop-停止已经处于运行状态的容器，但不删除它" class="sidebar-link">19、stop 停止已经处于运行状态的容器，但不删除它</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_20、top-显示运行的进程" class="sidebar-link">20、top 显示运行的进程</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_21、unpause-恢复处于暂停状态中的服务" class="sidebar-link">21、unpause 恢复处于暂停状态中的服务</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_22、up-自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作" class="sidebar-link">22、up 自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_23、version-打印版本信息" class="sidebar-link">23、version 打印版本信息</a></li></ul></li><li><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_5-compose模板文件" class="sidebar-link">5. Compose模板文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#build" class="sidebar-link">build</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#cap-add-cap-drop" class="sidebar-link">capadd, capdrop</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#command" class="sidebar-link">command</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#configs" class="sidebar-link">configs</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#cgroup-parent" class="sidebar-link">cgroup_parent</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#container-name" class="sidebar-link">container_name</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#deploy" class="sidebar-link">deploy</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#devices" class="sidebar-link">devices</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#depends-on" class="sidebar-link">depends_on</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#dns" class="sidebar-link">dns</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#dns-search" class="sidebar-link">dns_search</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#tmpfs" class="sidebar-link">tmpfs</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#env-file" class="sidebar-link">env_file</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#environment" class="sidebar-link">environment</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#expose" class="sidebar-link">expose</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#external-links" class="sidebar-link">external_links</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#extra-hosts" class="sidebar-link">extra_hosts</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#healthcheck" class="sidebar-link">healthcheck</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#image" class="sidebar-link">image</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#labels" class="sidebar-link">labels</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#links" class="sidebar-link">links</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#logging" class="sidebar-link">logging</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#network-mode" class="sidebar-link">network_mode</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#networks" class="sidebar-link">networks</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#pid" class="sidebar-link">pid</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#ports" class="sidebar-link">ports</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#secrets" class="sidebar-link">secrets</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#security-opt" class="sidebar-link">security_opt</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#stop-signal" class="sidebar-link">stop_signal</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#sysctls" class="sidebar-link">sysctls</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#ulimits" class="sidebar-link">ulimits</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#volumes" class="sidebar-link">volumes</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#读取变量" class="sidebar-link">读取变量</a></li></ul></li><li><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#_6-docker-compose-实战" class="sidebar-link">6. docker-compose 实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#docker-compose-mysql5-7-yml" class="sidebar-link">docker-compose-mysql5.7.yml</a></li><li class="sidebar-sub-header"><a href="/technology/Docker%20%E4%B8%89%E5%89%91%E5%AE%A2%20Compose.html#docker-compose-mysql5-8-yml" class="sidebar-link">docker-compose-mysql5.8.yml</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="_1-什么是-docker-compose"><a href="#_1-什么是-docker-compose" aria-hidden="true" class="header-anchor">#</a> 1. 什么是 Docker Compose</h2> <p><img src="/assets/img/1563674617938.ebebc7ae.png" alt="enter description here"></p> <p>Docker Compose 是 Docker 官方编排（Orchestration）项目之一，负责快速的部署分布式应用。</p> <h2 id="_2-docker-compose-简介"><a href="#_2-docker-compose-简介" aria-hidden="true" class="header-anchor">#</a> 2. Docker Compose 简介</h2> <p>Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 OpenStack 中的 Heat 十分类似。
其代码目前在 https://github.com/docker/compose 上开源。</p> <p>Compose 定位是 「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」，其前身是开源项目 Fig。</p> <p>我们知道使用一个 Dockerfile 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。</p> <p>Compose 恰好满足了这样的需求。它允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p> <p>Compose 中有两个重要的概念：</p> <ul><li><p>服务（service）：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</p></li> <li><p>项目（project）：由一组关联的应用容器组成的一个完成业务单元，在docker-compose.yml中定义。</p></li></ul> <p>以上可以理解为：
服务（service）就是在它下面可以定义应用需要的一些服务，代表配置文件中的每一项服务。每个服务都有自己的名字、使用的镜像、挂载的数据卷、所属的网络、依赖哪些其他服务等等，即以容器为粒度，用户需要Compose所完成的任务。</p> <p>项目（project）代表用户需要完成的一个项目，即是Compose的一个配置文件可以解析为一个项目，即Compose通过分析指定配置文件，得出配置文件所需完成的所有容器管理与部署操作。</p> <p>Compose 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。</p> <p>Compose 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 Compose 来进行编排管理。</p> <h2 id="_3-docker-compose-安装与卸载"><a href="#_3-docker-compose-安装与卸载" aria-hidden="true" class="header-anchor">#</a> 3. Docker Compose 安装与卸载</h2> <p>Compose 支持 Linux、macOS、Windows 10 三大平台。</p> <p>Compose 可以通过 Python 的包管理工具 pip 进行安装，也可以直接下载编译好的二进制文件使用，甚至能够直接在 Docker 容器中运行。</p> <p>前两种方式是传统方式，适合本地环境下安装使用；最后一种方式则不破坏系统环境，更适合云计算场景。</p> <p>Docker for Mac 、Docker for Windows 自带 docker-compose 二进制文件，安装 Docker 之后可以直接使用。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>docker<span class="token operator">-</span>compose <span class="token operator">--</span>version
docker<span class="token operator">-</span>compose version <span class="token number">1.24</span><span class="token number">.1</span><span class="token punctuation">,</span> build <span class="token number">4667896</span>b

</code></pre></div><p>Linux 系统请使用以下介绍的方法安装。</p> <ul><li>二进制包</li></ul> <p>在 Linux 上的也安装十分简单，从 官方 GitHub Release 处直接下载编译好的二进制文件即可。</p> <p>例如，在 Linux 64 位系统上直接下载对应的二进制包。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>curl <span class="token operator">-</span><span class="token constant">L</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>docker<span class="token operator">/</span>compose<span class="token operator">/</span>releases<span class="token operator">/</span>download<span class="token operator">/</span><span class="token number">1.24</span><span class="token number">.1</span><span class="token operator">/</span>docker<span class="token operator">-</span>compose<span class="token operator">-</span><span class="token template-string"><span class="token string">`uname -s`</span></span><span class="token operator">-</span><span class="token template-string"><span class="token string">`uname -m`</span></span> <span class="token operator">-</span>o <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>compose
chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>compose
</code></pre></div><ul><li>PIP 安装</li></ul> <p>注： x86_64 架构的 Linux 建议按照上边的方法下载二进制包进行安装，如果您计算机的架构是 ARM (例如，树莓派)，再使用 pip 安装。</p> <p>这种方式是将 Compose 当作一个 Python 应用来从 pip 源中安装。</p> <p>执行安装命令：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sudo pip install <span class="token operator">-</span><span class="token constant">U</span> docker<span class="token operator">-</span>compose
</code></pre></div><ul><li>容器中执行</li></ul> <p>Compose 既然是一个 Python 应用，自然也可以直接用容器来执行它。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> curl <span class="token operator">-</span><span class="token constant">L</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>docker<span class="token operator">/</span>compose<span class="token operator">/</span>releases<span class="token operator">/</span>download<span class="token operator">/</span><span class="token number">1.24</span><span class="token number">.1</span><span class="token operator">/</span>run<span class="token punctuation">.</span>sh <span class="token operator">&gt;</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>compose
 chmod <span class="token operator">+</span>x <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>compose
</code></pre></div><p>实际上，查看下载的 run.sh 脚本内容，如下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>#<span class="token operator">!</span><span class="token operator">/</span>bin<span class="token operator">/</span>sh
#
# Run docker<span class="token operator">-</span>compose <span class="token keyword">in</span> a container
#
# This script will attempt to mirror the host paths by using volumes <span class="token keyword">for</span> the
# following paths<span class="token punctuation">:</span>
#   <span class="token operator">*</span> <span class="token function">$</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span>
#   <span class="token operator">*</span> <span class="token function">$</span><span class="token punctuation">(</span>dirname $<span class="token constant">COMPOSE_FILE</span><span class="token punctuation">)</span> <span class="token keyword">if</span> it's <span class="token keyword">set</span>
#   <span class="token operator">*</span> $<span class="token constant">HOME</span> <span class="token keyword">if</span> it's <span class="token keyword">set</span>
#
# You can add additional <span class="token function">volumes</span> <span class="token punctuation">(</span>or any docker run options<span class="token punctuation">)</span> using
# the $<span class="token constant">COMPOSE_OPTIONS</span> environment variable<span class="token punctuation">.</span>
#


<span class="token keyword">set</span> <span class="token operator">-</span>e

<span class="token constant">VERSION</span><span class="token operator">=</span><span class="token string">&quot;1.24.1&quot;</span>
<span class="token constant">IMAGE</span><span class="token operator">=</span><span class="token string">&quot;docker/compose:$VERSION&quot;</span>


# Setup options <span class="token keyword">for</span> connecting to docker host
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">-</span>z <span class="token string">&quot;$DOCKER_HOST&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
    <span class="token constant">DOCKER_HOST</span><span class="token operator">=</span><span class="token string">&quot;/var/run/docker.sock&quot;</span>
fi
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">-</span><span class="token constant">S</span> <span class="token string">&quot;$DOCKER_HOST&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
    <span class="token constant">DOCKER_ADDR</span><span class="token operator">=</span><span class="token string">&quot;-v $DOCKER_HOST:$DOCKER_HOST -e DOCKER_HOST&quot;</span>
<span class="token keyword">else</span>
    <span class="token constant">DOCKER_ADDR</span><span class="token operator">=</span><span class="token string">&quot;-e DOCKER_HOST -e DOCKER_TLS_VERIFY -e DOCKER_CERT_PATH&quot;</span>
fi


# Setup volume mounts <span class="token keyword">for</span> compose config and context
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;$(pwd)&quot;</span> <span class="token operator">!=</span> <span class="token string">'/'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
    <span class="token constant">VOLUMES</span><span class="token operator">=</span><span class="token string">&quot;-v $(pwd):$(pwd)&quot;</span>
fi
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">-</span>n <span class="token string">&quot;$COMPOSE_FILE&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
    <span class="token constant">COMPOSE_OPTIONS</span><span class="token operator">=</span><span class="token string">&quot;$COMPOSE_OPTIONS -e COMPOSE_FILE=$COMPOSE_FILE&quot;</span>
    compose_dir<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>realpath <span class="token function">$</span><span class="token punctuation">(</span>dirname $<span class="token constant">COMPOSE_FILE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fi
# <span class="token constant">TODO</span><span class="token punctuation">:</span> also check <span class="token operator">--</span>file argument
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">-</span>n <span class="token string">&quot;$compose_dir&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
    <span class="token constant">VOLUMES</span><span class="token operator">=</span><span class="token string">&quot;$VOLUMES -v $compose_dir:$compose_dir&quot;</span>
fi
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">-</span>n <span class="token string">&quot;$HOME&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
    <span class="token constant">VOLUMES</span><span class="token operator">=</span><span class="token string">&quot;$VOLUMES -v $HOME:$HOME -v $HOME:/root&quot;</span> # mount $<span class="token constant">HOME</span> <span class="token keyword">in</span> <span class="token operator">/</span>root to share docker<span class="token punctuation">.</span>config
fi

# Only allocate tty <span class="token keyword">if</span> we detect one
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">-</span>t <span class="token number">0</span> <span class="token operator">-</span>a <span class="token operator">-</span>t <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
        <span class="token constant">DOCKER_RUN_OPTIONS</span><span class="token operator">=</span><span class="token string">&quot;$DOCKER_RUN_OPTIONS -t&quot;</span>
fi

# Always <span class="token keyword">set</span> <span class="token operator">-</span>i to support piped and terminal input <span class="token keyword">in</span> run<span class="token operator">/</span>exec
<span class="token constant">DOCKER_RUN_OPTIONS</span><span class="token operator">=</span><span class="token string">&quot;$DOCKER_RUN_OPTIONS -i&quot;</span>


# Handle userns security
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token operator">-</span>z <span class="token string">&quot;$(docker info 2&gt;/dev/null | grep userns)&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
    <span class="token constant">DOCKER_RUN_OPTIONS</span><span class="token operator">=</span><span class="token string">&quot;$DOCKER_RUN_OPTIONS --userns=host&quot;</span>
fi

exec docker run <span class="token operator">--</span>rm $<span class="token constant">DOCKER_RUN_OPTIONS</span> $<span class="token constant">DOCKER_ADDR</span> $<span class="token constant">COMPOSE_OPTIONS</span> $<span class="token constant">VOLUMES</span> <span class="token operator">-</span>w <span class="token string">&quot;$(pwd)&quot;</span> $<span class="token constant">IMAGE</span> <span class="token string">&quot;$@&quot;</span>


</code></pre></div><p>可以看到，它其实是下载了 docker/compose 镜像并运行。</p> <ul><li>卸载
如果是二进制包方式安装的，删除二进制文件即可。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>rm <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>docker<span class="token operator">-</span>compose

</code></pre></div><p>如果是通过 pip 安装的，则执行如下命令即可删除。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>pip uninstall docker<span class="token operator">-</span>compose
</code></pre></div><h2 id="_4-compose常用命令"><a href="#_4-compose常用命令" aria-hidden="true" class="header-anchor">#</a> 4. Compose常用命令</h2> <p>在我们使用Compose前，可以通过执行docker-compose --help|-h来查看Compose基本命令用法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>efine and run multi<span class="token operator">-</span>container applications <span class="token keyword">with</span> Docker<span class="token punctuation">.</span>

Usage<span class="token punctuation">:</span>
  docker<span class="token operator">-</span>compose <span class="token punctuation">[</span><span class="token operator">-</span>f <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">COMMAND</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">ARGS</span><span class="token operator">...</span><span class="token punctuation">]</span>
  docker<span class="token operator">-</span>compose <span class="token operator">-</span>h<span class="token operator">|</span><span class="token operator">--</span>help

Options<span class="token punctuation">:</span>
  <span class="token operator">-</span>f<span class="token punctuation">,</span> <span class="token operator">--</span>file <span class="token constant">FILE</span>             Specify an alternate compose <span class="token function">file</span>
                              <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">:</span> docker<span class="token operator">-</span>compose<span class="token punctuation">.</span>yml<span class="token punctuation">)</span>
  <span class="token operator">-</span>p<span class="token punctuation">,</span> <span class="token operator">--</span>project<span class="token operator">-</span>name <span class="token constant">NAME</span>     Specify an alternate project <span class="token function">name</span>
                              <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">:</span> directory name<span class="token punctuation">)</span>
  <span class="token operator">--</span>verbose                   Show more output
  <span class="token operator">--</span>log<span class="token operator">-</span>level <span class="token constant">LEVEL</span>           Set log <span class="token function">level</span> <span class="token punctuation">(</span><span class="token constant">DEBUG</span><span class="token punctuation">,</span> <span class="token constant">INFO</span><span class="token punctuation">,</span> <span class="token constant">WARNING</span><span class="token punctuation">,</span> <span class="token constant">ERROR</span><span class="token punctuation">,</span> <span class="token constant">CRITICAL</span><span class="token punctuation">)</span>
  <span class="token operator">--</span>no<span class="token operator">-</span>ansi                   Do not print <span class="token constant">ANSI</span> control characters
  <span class="token operator">-</span>v<span class="token punctuation">,</span> <span class="token operator">--</span>version               Print version and exit
  <span class="token operator">-</span><span class="token constant">H</span><span class="token punctuation">,</span> <span class="token operator">--</span>host <span class="token constant">HOST</span>             Daemon socket to connect to

  <span class="token operator">--</span>tls                       Use <span class="token constant">TLS</span><span class="token punctuation">;</span> implied by <span class="token operator">--</span>tlsverify
  <span class="token operator">--</span>tlscacert <span class="token constant">CA_PATH</span>         Trust certs signed only by <span class="token keyword">this</span> <span class="token constant">CA</span>
  <span class="token operator">--</span>tlscert <span class="token constant">CLIENT_CERT_PATH</span>  Path to <span class="token constant">TLS</span> certificate file
  <span class="token operator">--</span>tlskey <span class="token constant">TLS_KEY_PATH</span>       Path to <span class="token constant">TLS</span> key file
  <span class="token operator">--</span>tlsverify                 Use <span class="token constant">TLS</span> and verify the remote
  <span class="token operator">--</span>skip<span class="token operator">-</span>hostname<span class="token operator">-</span>check       Don<span class="token string">'t check the daemon'</span>s hostname against the
                              name specified <span class="token keyword">in</span> the client certificate
  <span class="token operator">--</span>project<span class="token operator">-</span>directory <span class="token constant">PATH</span>    Specify an alternate working <span class="token function">directory</span>
                              <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">:</span> the path <span class="token keyword">of</span> the Compose file<span class="token punctuation">)</span>
  <span class="token operator">--</span>compatibility             If <span class="token keyword">set</span><span class="token punctuation">,</span> Compose will attempt to convert keys
                              <span class="token keyword">in</span> v3 files to their non<span class="token operator">-</span>Swarm equivalent

Commands<span class="token punctuation">:</span>
  build              Build or rebuild services
  bundle             Generate a Docker bundle <span class="token keyword">from</span> the Compose file
  config             Validate and view the Compose file
  create             Create services
  down               Stop and remove containers<span class="token punctuation">,</span> networks<span class="token punctuation">,</span> images<span class="token punctuation">,</span> and volumes
  events             Receive real time events <span class="token keyword">from</span> containers
  exec               Execute a command <span class="token keyword">in</span> a running container
  help               Get help on a command
  images             List images
  kill               Kill containers
  logs               View output <span class="token keyword">from</span> containers
  pause              Pause services
  port               Print the <span class="token keyword">public</span> port <span class="token keyword">for</span> a port binding
  ps                 List containers
  pull               Pull service images
  push               Push service images
  restart            Restart services
  rm                 Remove stopped containers
  run                Run a one<span class="token operator">-</span>off command
  scale              Set number <span class="token keyword">of</span> containers <span class="token keyword">for</span> a service
  start              Start services
  stop               Stop services
  top                Display the running processes
  unpause            Unpause services
  up                 Create and start containers
  version            Show the Docker<span class="token operator">-</span>Compose version information
</code></pre></div><p>我们也可以通过执行docker-compose [COMMAND] --help或者docker-compose --help [COMMAND]来查看某个具体的使用格式。</p> <p>从上面的提示中我们可以知道Compose命令的基本的使用格式为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>docker<span class="token operator">-</span>compose <span class="token punctuation">[</span><span class="token operator">-</span>f <span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">COMMAND</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">ARGS</span><span class="token operator">...</span><span class="token punctuation">]</span>
</code></pre></div><p>命令选项如下：</p> <ul><li>-f，–file FILE指定使用的Compose模板文件，默认为docker-compose.yml，可以多次指定。</li> <li>-p，–project-name NAME指定项目名称，默认将使用所在目录名称作为项目名。</li> <li>-x-network-driver 使用Docker的可拔插网络后端特性（需要Docker 1.9 及以后版本）</li> <li>-x-network-driver DRIVER指定网络后端的驱动，默认为bridge（需要Docker 1.9 及以后版本）</li> <li>-verbose输出更多调试信息</li> <li>-v，–version打印版本并退出</li></ul> <p>Docker Compose常用命令列表如下：</p> <p>build	构建项目中的服务容器
help	获得一个命令的帮助
kill	通过发送SIGKILL信号来强制停止服务容器
config	验证和查看compose文件配置
create	为服务创建容器。只是单纯的create，还需要使用start启动compose
down	停止并删除容器，网络，镜像和数据卷
exec	在运行的容器中执行一个命令
logs	查看服务容器的输出
pause	暂停一个服务容器
port	打印某个容器端口所映射的公共端口
ps	列出项目中目前的所有容器
pull	拉取服务依赖的镜像
push	推送服务镜像
restart	重启项目中的服务
rm	删除所有（停止状态的）服务容器
run	在指定服务上执行一个命令
scale	设置指定服务运行的容器个数
start	启动已经存在的服务容器
stop	停止已经处于运行状态的容器，但不删除它
top	显示运行的进程
unpause	恢复处于暂停状态中的服务
up	自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作
version	打印版本信息</p> <p>命令详解：</p> <h3 id="_1、build构建项目中的服务容器"><a href="#_1、build构建项目中的服务容器" aria-hidden="true" class="header-anchor">#</a> 1、build	构建项目中的服务容器</h3> <p>格式为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>docker<span class="token operator">-</span>compose build <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>build<span class="token operator">-</span>arg key<span class="token operator">=</span>val<span class="token operator">...</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">SERVICE</span><span class="token operator">...</span><span class="token punctuation">]</span>
</code></pre></div><p>构建（重新构建）项目中的服务容器。</p> <p>选项包括：</p> <ul><li>–compress 通过gzip压缩构建上下环境</li> <li>–force-rm 删除构建过程中的临时容器</li> <li>–no-cache 构建镜像过程中不使用缓存</li> <li>–pull 始终尝试通过拉取操作来获取更新版本的镜像</li> <li>-m, --memory MEM 为构建的容器设置内存大小</li> <li>–build-arg key=val 为服务设置build-time变量</li></ul> <h3 id="_2、help获得一个命令的帮助"><a href="#_2、help获得一个命令的帮助" aria-hidden="true" class="header-anchor">#</a> 2、help	获得一个命令的帮助</h3> <p>获得一个命令的帮助。</p> <h3 id="_3、kill通过发送sigkill信号来强制停止服务容器"><a href="#_3、kill通过发送sigkill信号来强制停止服务容器" aria-hidden="true" class="header-anchor">#</a> 3、kill	通过发送SIGKILL信号来强制停止服务容器</h3> <p>格式为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>docker<span class="token operator">-</span>compose kill <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token constant">SERVICE</span><span class="token operator">...</span><span class="token punctuation">]</span>
</code></pre></div><p>通过发送SIGKILL信号来强制停止服务容器。
支持通过-s参数来指定发送的信号，例如通过如下指令发送SIGINT信号：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>docker<span class="token operator">-</span>compose kill <span class="token operator">-</span>s <span class="token constant">SIGINT</span>
</code></pre></div><h3 id="_4、config验证和查看compose文件配置"><a href="#_4、config验证和查看compose文件配置" aria-hidden="true" class="header-anchor">#</a> 4、config	验证和查看compose文件配置</h3> <p>格式为：</p> <div class="language-gams extra-class"><pre class="language-text"><code>docker-compose config [options]
</code></pre></div><p>验证并查看compose文件配置。</p> <p>选项包括：</p> <ul><li>–resolve-image-digests 将镜像标签标记为摘要</li> <li>-q, --quiet 只验证配置，不输出。 当配置正确时，不输出任何内容，当文件配置错误，输出错误信息</li> <li>–services 打印服务名，一行一个</li> <li>–volumes 打印数据卷名，一行一个</li></ul> <h3 id="_5、create为服务创建容器"><a href="#_5、create为服务创建容器" aria-hidden="true" class="header-anchor">#</a> 5、create	为服务创建容器</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose create</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>为服务创建容器.只是单纯的create，还需要使用start启动compose。</p> <p>选项包括：</p> <ul><li>–force-recreate 重新创建容器，即使它的配置和镜像没有改变，不兼容–no-recreate参数</li> <li>–no-recreate 如果容器已经存在，不需要重新创建. 不兼容–force-recreate参数</li> <li>–no-build 不创建镜像，即使缺失</li> <li>–build 创建容器前，生成镜像</li></ul> <h3 id="_6、down停止并删除容器，网络，镜像和数据卷"><a href="#_6、down停止并删除容器，网络，镜像和数据卷" aria-hidden="true" class="header-anchor">#</a> 6、down	停止并删除容器，网络，镜像和数据卷</h3> <p>格式为：</p> <div class="language-gams extra-class"><pre class="language-text"><code>docker-compose down [options]
</code></pre></div><p>停止和删除容器、网络、卷、镜像，这些内容是通过docker-compose up命令创建的. 默认值删除 容器 网络，可以通过指定 rmi 、volumes参数删除镜像和卷。</p> <p>选项包括：</p> <ul><li>–rmi type 删除镜像，类型必须是: ‘all’: 删除compose文件中定义的所以镜像；‘local’: 删除镜像名为空的镜像</li> <li>-v, --volumes 删除已经在compose文件中定义的和匿名的附在容器上的数据卷</li> <li>–remove-orphans 删除服务中没有在compose中定义的容器</li></ul> <h3 id="_7、exec-在运行的容器中执行一个命令"><a href="#_7、exec-在运行的容器中执行一个命令" aria-hidden="true" class="header-anchor">#</a> 7、exec 在运行的容器中执行一个命令</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker exec</span> <span class="token comment">[options]</span> <span class="token text comment">SERVICE COMMAND</span> <span class="token comment">[ARGS...]</span>
</code></pre></div><p>与docker exec命令功能相同，可以通过service name登陆到容器中。</p> <p>选项包括：</p> <ul><li>-d 分离模式，后台运行命令.</li> <li>–privileged 获取特权.</li> <li>–user USER 指定运行的用户.</li> <li>-T 禁用分配TTY. By default docker-compose exec分配 a TTY.</li> <li>–index=index 当一个服务拥有多个容器时，可通过该参数登陆到该服务下的任何服务，例如：docker-compose exec --index=1 web /bin/bash ，web服务中包含多个容器</li></ul> <h3 id="_8、logs-查看服务容器的输出"><a href="#_8、logs-查看服务容器的输出" aria-hidden="true" class="header-anchor">#</a> 8、logs 查看服务容器的输出</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose logs</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>查看服务容器的输出。默认情况下，docker-compose将对不同的服务输出使用不同的颜色来区分。可以通过–no-color来关闭颜色。</p> <h3 id="_9、pause-暂停一个服务容器"><a href="#_9、pause-暂停一个服务容器" aria-hidden="true" class="header-anchor">#</a> 9、pause 暂停一个服务容器</h3> <p>格式为：</p> <div class="language-scilab extra-class"><pre class="language-text"><code>docker-compose pause [SERVICE...]
</code></pre></div><p>暂停一个服务容器。</p> <h3 id="_10、port-打印某个容器端口所映射的公共端口"><a href="#_10、port-打印某个容器端口所映射的公共端口" aria-hidden="true" class="header-anchor">#</a> 10、port 打印某个容器端口所映射的公共端口</h3> <p>格式为：</p> <div class="language-gams extra-class"><pre class="language-text"><code>docker-compose port [options] SERVICE PRIVATE_PORT
</code></pre></div><p>显示某个容器端口所映射的公共端口。</p> <p>选项包括：</p> <ul><li>–protocol=proto 指定端口协议，TCP（默认值）或者UDP</li> <li>–index=index 如果同意服务存在多个容器，指定命令对象容器的序号（默认为1）</li></ul> <h3 id="_11、ps-列出项目中目前的所有容器"><a href="#_11、ps-列出项目中目前的所有容器" aria-hidden="true" class="header-anchor">#</a> 11、ps 列出项目中目前的所有容器</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose ps</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>列出项目中目前的所有容器。</p> <p>选项包括：</p> <ul><li>-q 只打印容器的ID信息</li></ul> <h3 id="_12、pull-拉取服务依赖的镜像"><a href="#_12、pull-拉取服务依赖的镜像" aria-hidden="true" class="header-anchor">#</a> 12、pull 拉取服务依赖的镜像</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose pull</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>拉取服务依赖的镜像。</p> <p>选项包括：</p> <ul><li>–ignore-pull-failures 忽略拉取镜像过程中的错误</li> <li>–parallel 多个镜像同时拉取</li> <li>–quiet 拉取镜像过程中不打印进度信息</li></ul> <h3 id="_13、push-推送服务镜像"><a href="#_13、push-推送服务镜像" aria-hidden="true" class="header-anchor">#</a> 13、push 推送服务镜像</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose push</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>推送服务依的镜像。</p> <p>选项包括：</p> <ul><li>–ignore-push-failures 忽略推送镜像过程中的错误</li></ul> <h3 id="_14、restart-重启项目中的服务"><a href="#_14、restart-重启项目中的服务" aria-hidden="true" class="header-anchor">#</a> 14、restart 重启项目中的服务</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose restart</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>重启项目中的服务。</p> <p>选项包括：</p> <ul><li>-t, --timeout TIMEOUT 指定重启前停止容器的超时（默认为10秒）</li></ul> <h3 id="_15、rm-删除所有（停止状态的）服务容器"><a href="#_15、rm-删除所有（停止状态的）服务容器" aria-hidden="true" class="header-anchor">#</a> 15、rm 删除所有（停止状态的）服务容器</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose rm</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>删除所有（停止状态的）服务容器。</p> <p>选项包括：</p> <ul><li>–f, --force 强制直接删除，包括非停止状态的容器</li> <li>-v 删除容器所挂载的数据卷</li></ul> <h3 id="_16、run-在指定服务上执行一个命令"><a href="#_16、run-在指定服务上执行一个命令" aria-hidden="true" class="header-anchor">#</a> 16、run 在指定服务上执行一个命令</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose run</span> <span class="token comment">[options]</span> <span class="token comment">[-v VOLUME...]</span> <span class="token comment">[-p PORT...]</span> <span class="token comment">[-e KEY=VAL...]</span> <span class="token text comment">SERVICE</span> <span class="token comment">[COMMAND]</span> <span class="token comment">[ARGS...]</span>
</code></pre></div><p>在指定服务上执行一个命令。</p> <p>例如：</p> <div class="language-stylus extra-class"><pre class="language-stylus"><code><span class="token property-declaration"><span class="token property">docker-compose</span> run ubuntu ping www<span class="token operator">.</span>anumbrella<span class="token operator">.</span>net</span>
</code></pre></div><p>将会执行一个ubuntu容器，并执行ping www.anumbrella.net命令。</p> <p>默认情况下，如果存在关联，则所有关联的服务将会自动被启动，除非这些服务已经在运行中。该命令类似于启动容器后运行指定的命令，相关卷、链接等都会按照配置自动创建。有两个不同点：</p> <p>给定命令将会覆盖原有的自动运行命令
不会自动创建端口，以避免冲突
如果不希望自动启动关联的容器，可以使用–no-deps选项，例如：</p> <div class="language-stata extra-class"><pre class="language-text"><code>docker-compose run --no-deps web
</code></pre></div><p>将不会启动web容器关联的其他容器。</p> <p>选项包括：</p> <ul><li>-d 在后台运行服务容器</li> <li>–name NAME 为容器指定一个名字</li> <li>–entrypoint CMD 覆盖默认的容器启动指令</li> <li>-e KEY=VAL 设置环境变量值，可多次使用选项来设置多个环境变量</li> <li>-u, --user=&quot;&quot; 指定运行容器的用户名或者uid</li> <li>–no-deps 不自动启动管理的服务容器</li> <li>–rm 运行命令后自动删除容器，d模式下将忽略</li> <li>-p, --publish=[] 映射容器端口到本地主机</li> <li>–service-ports 配置服务端口并映射到本地主机</li> <li>-v, --volume=[] 绑定一个数据卷，默认为空</li> <li>T 不分配伪tty，意味着依赖tty的指令将无法运行</li> <li>-w, --workdir=&quot;&quot; 为容器指定默认工作目录</li></ul> <h3 id="_17、scale-设置指定服务运行的容器个数"><a href="#_17、scale-设置指定服务运行的容器个数" aria-hidden="true" class="header-anchor">#</a> 17、scale 设置指定服务运行的容器个数</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose scale</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE=NUM...]</span>
</code></pre></div><p>设置指定服务运行的容器个数。
通过service=num的参数来设置数量。例如：</p> <div class="language-lsl extra-class"><pre class="language-text"><code>docker-compose scale web=3 db=2
</code></pre></div><p>将启动3个容器运行web服务，2个容器运行db服务。一般情况下，当指定书目多于该服务当前实际运行容器，将新创建并启动容器；反之，将停止容器。</p> <p>选项包括：</p> <ul><li>-t, --timeout TIMEOUT 停止容器时候的超时（默认为10秒）</li></ul> <h3 id="_18、start-启动已经存在的服务容器"><a href="#_18、start-启动已经存在的服务容器" aria-hidden="true" class="header-anchor">#</a> 18、start 启动已经存在的服务容器</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose start</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>启动已经存在的服务容器。</p> <h3 id="_19、stop-停止已经处于运行状态的容器，但不删除它"><a href="#_19、stop-停止已经处于运行状态的容器，但不删除它" aria-hidden="true" class="header-anchor">#</a> 19、stop 停止已经处于运行状态的容器，但不删除它</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose stop</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>停止已经处于运行状态的容器，但不删除它。</p> <p>选项包括：</p> <ul><li>-t, --timeout TIMEOUT 停止容器时候的超时（默认为10秒）</li></ul> <h3 id="_20、top-显示运行的进程"><a href="#_20、top-显示运行的进程" aria-hidden="true" class="header-anchor">#</a> 20、top 显示运行的进程</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose stop</span> <span class="token comment">[options]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>显示各个容器运行的进程情况。</p> <h3 id="_21、unpause-恢复处于暂停状态中的服务"><a href="#_21、unpause-恢复处于暂停状态中的服务" aria-hidden="true" class="header-anchor">#</a> 21、unpause 恢复处于暂停状态中的服务</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose unpause</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>恢复处于暂停状态中的服务。</p> <h3 id="_22、up-自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作"><a href="#_22、up-自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作" aria-hidden="true" class="header-anchor">#</a> 22、up 自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作</h3> <p>格式为：</p> <div class="language-inform7 extra-class"><pre class="language-inform7"><code><span class="token text comment">docker-compose</span> <span class="token position keyword">up</span> <span class="token comment">[options]</span> <span class="token comment">[--scale SERVICE=NUM...]</span> <span class="token comment">[SERVICE...]</span>
</code></pre></div><p>up命令十分强大，它尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一些列操作。链接的服务都将会被自动启动，除非已经处于运行状态。</p> <p>多数情况下我们可以直接通过该命令来启动一个项目。</p> <p>选项包括：</p> <ul><li>-d 在后台运行服务容器</li> <li>–no-color 不使用颜色来区分不同的服务的控制输出</li> <li>–no-deps 不启动服务所链接的容器</li> <li>–force-recreate 强制重新创建容器，不能与–no-recreate同时使用</li> <li>–no-recreate 如果容器已经存在，则不重新创建，不能与–force-recreate同时使用</li> <li>–no-build 不自动构建缺失的服务镜像</li> <li>–build 在启动容器前构建服务镜像</li> <li>–abort-on-container-exit 停止所有容器，如果任何一个容器被停止，不能与-d同时使用</li> <li>-t, --timeout TIMEOUT 停止容器时候的超时（默认为10秒）</li> <li>–remove-orphans 删除服务中没有在compose文件中定义的容器</li> <li>–scale SERVICE=NUM 设置服务运行容器的个数，将覆盖在compose中通过scale指定的参数</li></ul> <h3 id="_23、version-打印版本信息"><a href="#_23、version-打印版本信息" aria-hidden="true" class="header-anchor">#</a> 23、version 打印版本信息</h3> <p>格式为：</p> <div class="language-d extra-class"><pre class="language-d"><code>docker<span class="token operator">-</span>compose <span class="token keyword">version</span>
</code></pre></div><h2 id="_5-compose模板文件"><a href="#_5-compose模板文件" aria-hidden="true" class="header-anchor">#</a> 5. Compose模板文件</h2> <p>模板文件是使用 Compose 的核心，涉及到的指令关键字也比较多。但大家不用担心，这里面大部分指令跟 docker run 相关参数的含义都是类似的。</p> <p>默认的模板文件名称为 docker-compose.yml，格式为 YAML 格式。</p> <div class="language-dts extra-class"><pre class="language-text"><code>version: &quot;3&quot;

services:
  webapp:
    image: examples/web
    ports:
      - &quot;80:80&quot;
    volumes:
      - &quot;/data&quot;
</code></pre></div><p>注意每个服务都必须通过 image 指令指定镜像或 build 指令（需要 Dockerfile）等来自动构建生成镜像。</p> <p>如果使用 build 指令，在 Dockerfile 中设置的选项(例如：CMD, EXPOSE, VOLUME, ENV 等) 将会自动被获取，无需在 docker-compose.yml 中再次设置。</p> <p>下面分别介绍各个指令的用法。</p> <h3 id="build"><a href="#build" aria-hidden="true" class="header-anchor">#</a> build</h3> <p>指定 Dockerfile 所在文件夹的路径（可以是绝对路径，或者相对 docker-compose.yml 文件的路径）。 Compose 将会利用它自动构建这个镜像，然后使用这个镜像。</p> <div class="language-dts extra-class"><pre class="language-text"><code>version: '3'
services:

  webapp:
    build: ./dir
</code></pre></div><p>你也可以使用 context 指令指定 Dockerfile 所在文件夹的路径。</p> <p>使用 dockerfile 指令指定 Dockerfile 文件名。</p> <p>使用 arg 指令指定构建镜像时的变量。</p> <div class="language-dts extra-class"><pre class="language-text"><code>version: '3'
services:

  webapp:
    build:
      context: ./dir
      dockerfile: Dockerfile-alternate
      args:
        buildno: 1
</code></pre></div><p>使用 cache_from 指定构建镜像的缓存</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token property">build</span><span class="token punctuation">:</span>
  <span class="token property">context</span><span class="token punctuation">:</span> .
  <span class="token property">cache_from</span><span class="token punctuation">:</span>
    <span class="token operator">-</span> <span class="token property">alpine</span><span class="token punctuation">:</span>latest
    <span class="token operator">-</span> corp<span class="token operator">/</span><span class="token property">web_app</span><span class="token punctuation">:</span>3.14
</code></pre></div><h3 id="cap-add-cap-drop"><a href="#cap-add-cap-drop" aria-hidden="true" class="header-anchor">#</a> cap_add, cap_drop</h3> <p>指定容器的内核能力（capacity）分配。</p> <p>例如，让容器拥有所有能力可以指定为：</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>cap_add:
  - ALL
</code></pre></div><p>去掉 NET_ADMIN 能力可以指定为：</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>cap_drop:
  - NET_ADMIN
</code></pre></div><h3 id="command"><a href="#command" aria-hidden="true" class="header-anchor">#</a> command</h3> <p>覆盖容器启动后默认执行的命令。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>command: <span class="token keyword">echo</span> <span class="token string">&quot;hello world&quot;</span>
</code></pre></div><h3 id="configs"><a href="#configs" aria-hidden="true" class="header-anchor">#</a> configs</h3> <p>仅用于 Swarm mode</p> <h3 id="cgroup-parent"><a href="#cgroup-parent" aria-hidden="true" class="header-anchor">#</a> cgroup_parent</h3> <p>指定父 cgroup 组，意味着将继承该组的资源限制。</p> <p>例如，创建了一个 cgroup 组名称为 cgroups_1。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>cgroup_parent: cgroups_1
</code></pre></div><h3 id="container-name"><a href="#container-name" aria-hidden="true" class="header-anchor">#</a> container_name</h3> <p>指定容器名称。默认将会使用 项目名称_服务名称_序号 这样的格式。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>container_name: docker-web-container
</code></pre></div><p>注意: 指定容器名称后，该服务将无法进行扩展（scale），因为 Docker 不允许多个容器具有相同的名称。</p> <h3 id="deploy"><a href="#deploy" aria-hidden="true" class="header-anchor">#</a> deploy</h3> <p>仅用于 Swarm mode</p> <h3 id="devices"><a href="#devices" aria-hidden="true" class="header-anchor">#</a> devices</h3> <p>指定设备映射关系。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>devices:
  - &quot;/dev/ttyUSB1:/dev/ttyUSB0&quot;
</code></pre></div><h3 id="depends-on"><a href="#depends-on" aria-hidden="true" class="header-anchor">#</a> depends_on</h3> <p>解决容器的依赖、启动先后的问题。以下例子中会先启动 redis db 再启动 web</p> <div class="language-dts extra-class"><pre class="language-text"><code>version: '3'

services:
  web:
    build: .
    depends_on:
      - db
      - redis

  redis:
    image: redis

  db:
    image: postgres
</code></pre></div><p>注意：web 服务不会等待 redis db 「完全启动」之后才启动。</p> <h3 id="dns"><a href="#dns" aria-hidden="true" class="header-anchor">#</a> dns</h3> <p>自定义 DNS 服务器。可以是一个值，也可以是一个列表。</p> <div class="language-ldif extra-class"><pre class="language-text"><code>dns: 8.8.8.8

dns:
  - 8.8.8.8
  - 114.114.114.114
</code></pre></div><h3 id="dns-search"><a href="#dns-search" aria-hidden="true" class="header-anchor">#</a> dns_search</h3> <p>配置 DNS 搜索域。可以是一个值，也可以是一个列表。</p> <div class="language-ldif extra-class"><pre class="language-text"><code>dns_search: example.com

dns_search:
  - domain1.example.com
  - domain2.example.com
</code></pre></div><h3 id="tmpfs"><a href="#tmpfs" aria-hidden="true" class="header-anchor">#</a> tmpfs</h3> <p>挂载一个 tmpfs 文件系统到容器。</p> <div class="language-dockerfile extra-class"><pre class="language-text"><code>tmpfs: /run
tmpfs:
  - /run
  - /tmp
</code></pre></div><h3 id="env-file"><a href="#env-file" aria-hidden="true" class="header-anchor">#</a> env_file</h3> <p>从文件中获取环境变量，可以为单独的文件路径或列表。</p> <p>如果通过 docker-compose -f FILE 方式来指定 Compose 模板文件，则 env_file 中变量的路径会基于模板文件路径。</p> <p>如果有变量名称与 environment 指令冲突，则按照惯例，以后者为准。</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">env_file:</span> .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</code></pre></div><p>环境变量文件中每一行必须符合格式，支持 # 开头的注释行。</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token comment"># common.env: Set development environment</span>
PROG_ENV<span class="token operator">=</span>development
</code></pre></div><h3 id="environment"><a href="#environment" aria-hidden="true" class="header-anchor">#</a> environment</h3> <p>设置环境变量。你可以使用数组或字典两种格式。</p> <p>只给定名称的变量会自动获取运行 Compose 主机上对应变量的值，可以用来防止泄露不必要的数据。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span> development
  <span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span>

<span class="token key atrule">environment</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> RACK_ENV=development
  <span class="token punctuation">-</span> SESSION_SECRET
</code></pre></div><p>如果变量名称或者值中用到 true|false，yes|no 等表达 布尔 含义的词汇，最好放到引号里，避免 YAML 自动解析某些内容为对应的布尔语义。这些特定词汇，包括</p> <p>y|Y|yes|Yes|YES|n|N|no|No|NO|true|True|TRUE|false|False|FALSE|on|On|ON|off|Off|OFF</p> <h3 id="expose"><a href="#expose" aria-hidden="true" class="header-anchor">#</a> expose</h3> <p>暴露端口，但不映射到宿主机，只被连接的服务访问。</p> <p>仅可以指定内部端口为参数</p> <div class="language-haml extra-class"><pre class="language-haml"><code>expose:
 <span class="token punctuation">-</span><span class="token code"> <span class="token string">&quot;3000&quot;</span></span>
 <span class="token punctuation">-</span><span class="token code"> <span class="token string">&quot;8000&quot;</span></span>
</code></pre></div><h3 id="external-links"><a href="#external-links" aria-hidden="true" class="header-anchor">#</a> external_links</h3> <p>注意：不建议使用该指令。</p> <p>链接到 docker-compose.yml 外部的容器，甚至并非 Compose 管理的外部容器。</p> <div class="language-haml extra-class"><pre class="language-haml"><code>external_links:
 <span class="token punctuation">-</span><span class="token code"> redis_1</span>
 <span class="token punctuation">-</span><span class="token code"> project_db_1<span class="token symbol">:mysql</span></span>
 <span class="token punctuation">-</span><span class="token code"> project_db_1<span class="token symbol">:postgresql</span></span>
</code></pre></div><h3 id="extra-hosts"><a href="#extra-hosts" aria-hidden="true" class="header-anchor">#</a> extra_hosts</h3> <p>类似 Docker 中的 --add-host 参数，指定额外的 host 名称映射信息。</p> <div class="language-haml extra-class"><pre class="language-haml"><code>extra_hosts:
 <span class="token punctuation">-</span><span class="token code"> <span class="token string">&quot;googledns:8.8.8.8&quot;</span></span>
 <span class="token punctuation">-</span><span class="token code"> <span class="token string">&quot;dockerhub:52.1.157.61&quot;</span></span>
</code></pre></div><p>会在启动后的服务容器中 /etc/hosts 文件中添加如下两条条目。</p> <div class="language-lsl extra-class"><pre class="language-text"><code>8.8.8.8 googledns
52.1.157.61 dockerhub
</code></pre></div><h3 id="healthcheck"><a href="#healthcheck" aria-hidden="true" class="header-anchor">#</a> healthcheck</h3> <p>通过命令检查容器是否健康运行。</p> <div class="language-dts extra-class"><pre class="language-text"><code>healthcheck:
  test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]
  interval: 1m30s
  timeout: 10s
  retries: 3
</code></pre></div><h3 id="image"><a href="#image" aria-hidden="true" class="header-anchor">#</a> image</h3> <p>指定为镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会尝试拉取这个镜像。</p> <p>i</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>mage: ubuntu
image: orchardup/postgresql
image: a4bc65fd
</code></pre></div><h3 id="labels"><a href="#labels" aria-hidden="true" class="header-anchor">#</a> labels</h3> <p>为容器添加 Docker 元数据（metadata）信息。例如可以为容器添加辅助说明信息。</p> <div class="language-stylus extra-class"><pre class="language-stylus"><code>labels<span class="token punctuation">:</span>
  com<span class="token punctuation">.</span>startupteam<span class="token punctuation">.</span>description<span class="token punctuation">:</span> <span class="token string">&quot;webapp for a startup team&quot;</span>
  com<span class="token punctuation">.</span>startupteam<span class="token punctuation">.</span>department<span class="token punctuation">:</span> <span class="token string">&quot;devops department&quot;</span>
  com<span class="token punctuation">.</span>startupteam<span class="token punctuation">.</span>release<span class="token punctuation">:</span> <span class="token string">&quot;rc3 for v1.0&quot;</span>
</code></pre></div><h3 id="links"><a href="#links" aria-hidden="true" class="header-anchor">#</a> links</h3> <p>注意：不推荐使用该指令。</p> <h3 id="logging"><a href="#logging" aria-hidden="true" class="header-anchor">#</a> logging</h3> <p>配置日志选项。</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token property">logging</span><span class="token punctuation">:</span>
  <span class="token property">driver</span><span class="token punctuation">:</span> syslog
  <span class="token property">options</span><span class="token punctuation">:</span>
    <span class="token property">syslog-address</span><span class="token punctuation">:</span> <span class="token string">&quot;tcp://192.168.0.42:123&quot;</span>
</code></pre></div><p>目前支持三种日志驱动类型。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>driver: &quot;json-file&quot;
driver: &quot;syslog&quot;
driver: &quot;none&quot;
</code></pre></div><p>options 配置日志驱动的相关参数。</p> <div class="language-gams extra-class"><pre class="language-text"><code>options:
  max-size: &quot;200k&quot;
  max-file: &quot;10&quot;
</code></pre></div><h3 id="network-mode"><a href="#network-mode" aria-hidden="true" class="header-anchor">#</a> network_mode</h3> <p>设置网络模式。使用和 docker run 的 --network 参数一样的值。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>network_mode: &quot;bridge&quot;
network_mode: &quot;host&quot;
network_mode: &quot;none&quot;
network_mode: &quot;service:[service name]&quot;
network_mode: &quot;container:[container name/id]&quot;
</code></pre></div><h3 id="networks"><a href="#networks" aria-hidden="true" class="header-anchor">#</a> networks</h3> <p>配置容器连接的网络。</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token property">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
<span class="token property">services</span><span class="token punctuation">:</span>

  <span class="token property">some-service</span><span class="token punctuation">:</span>
    <span class="token property">networks</span><span class="token punctuation">:</span>
     <span class="token operator">-</span> some<span class="token operator">-</span>network
     <span class="token operator">-</span> other<span class="token operator">-</span>network

<span class="token property">networks</span><span class="token punctuation">:</span>
  <span class="token property">some-network</span><span class="token punctuation">:</span>
  <span class="token property">other-network</span><span class="token punctuation">:</span>
</code></pre></div><h3 id="pid"><a href="#pid" aria-hidden="true" class="header-anchor">#</a> pid</h3> <p>跟主机系统共享进程命名空间。打开该选项的容器之间，以及容器和宿主机系统之间可以通过进程 ID 来相互访问和操作。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>pid: &quot;host&quot;
</code></pre></div><h3 id="ports"><a href="#ports" aria-hidden="true" class="header-anchor">#</a> ports</h3> <p>暴露端口信息。</p> <p>使用宿主端口：容器端口 (HOST:CONTAINER) 格式，或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</p> <div class="language-haml extra-class"><pre class="language-haml"><code>ports:
 <span class="token punctuation">-</span><span class="token code"> <span class="token string">&quot;3000&quot;</span></span>
 <span class="token punctuation">-</span><span class="token code"> <span class="token string">&quot;8000:8000&quot;</span></span>
 <span class="token punctuation">-</span><span class="token code"> <span class="token string">&quot;49100:22&quot;</span></span>
 <span class="token punctuation">-</span><span class="token code"> <span class="token string">&quot;127.0.0.1:8001:8001&quot;</span></span>
</code></pre></div><p>注意：当使用 HOST:CONTAINER 格式来映射端口时，如果你使用的容器端口小于 60 并且没放到引号里，可能会得到错误结果，因为 YAML 会自动解析 xx:yy 这种数字格式为 60 进制。为避免出现这种问题，建议数字串都采用引号包括起来的字符串格式。</p> <h3 id="secrets"><a href="#secrets" aria-hidden="true" class="header-anchor">#</a> secrets</h3> <p>存储敏感数据，例如 mysql 服务密码。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

<span class="token key atrule">mysql</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token key atrule">MYSQL_ROOT_PASSWORD_FILE</span><span class="token punctuation">:</span> /run/secrets/db_root_password
  <span class="token key atrule">secrets</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> db_root_password
    <span class="token punctuation">-</span> my_other_secret

<span class="token key atrule">secrets</span><span class="token punctuation">:</span>
  <span class="token key atrule">my_secret</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> ./my_secret.txt
  <span class="token key atrule">my_other_secret</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h3 id="security-opt"><a href="#security-opt" aria-hidden="true" class="header-anchor">#</a> security_opt</h3> <p>指定容器模板标签（label）机制的默认属性（用户、角色、类型、级别等）。例如配置标签的用户名和角色名。</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>security_opt<span class="token punctuation">:</span>
    <span class="token operator">-</span> label<span class="token punctuation">:</span>user<span class="token punctuation">:</span>USER
    <span class="token operator">-</span> label<span class="token punctuation">:</span>role<span class="token punctuation">:</span>ROLE
</code></pre></div><h3 id="stop-signal"><a href="#stop-signal" aria-hidden="true" class="header-anchor">#</a> stop_signal</h3> <p>设置另一个信号来停止容器。在默认情况下使用的是 SIGTERM 停止容器。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>stop_signal: SIGUSR1
</code></pre></div><h3 id="sysctls"><a href="#sysctls" aria-hidden="true" class="header-anchor">#</a> sysctls</h3> <p>配置容器内核参数。</p> <div class="language-stylus extra-class"><pre class="language-stylus"><code>sysctls<span class="token punctuation">:</span>
  net<span class="token punctuation">.</span>core<span class="token punctuation">.</span>somaxconn<span class="token punctuation">:</span> 1024
  net<span class="token punctuation">.</span>ipv4<span class="token punctuation">.</span>tcp_syncookies<span class="token punctuation">:</span> 0

sysctls<span class="token punctuation">:</span>
  <span class="token property-declaration"><span class="token property">-</span> net<span class="token operator">.</span>core<span class="token operator">.</span>somaxconn<span class="token operator">=</span><span class="token number">1024</span></span>
  <span class="token property-declaration"><span class="token property">-</span> net<span class="token operator">.</span>ipv4<span class="token operator">.</span>tcp_syncookies<span class="token operator">=</span><span class="token number">0</span></span>
</code></pre></div><h3 id="ulimits"><a href="#ulimits" aria-hidden="true" class="header-anchor">#</a> ulimits</h3> <p>指定容器的 ulimits 限制值。</p> <p>例如，指定最大进程数为 65535，指定文件句柄数为 20000（软限制，应用可以随时修改，不能超过硬限制） 和 40000（系统硬限制，只能 root 用户提高）。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>  <span class="token key atrule">ulimits</span><span class="token punctuation">:</span>
    <span class="token key atrule">nproc</span><span class="token punctuation">:</span> <span class="token number">65535</span>
    <span class="token key atrule">nofile</span><span class="token punctuation">:</span>
      <span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">20000</span>
      <span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">40000</span>
</code></pre></div><h3 id="volumes"><a href="#volumes" aria-hidden="true" class="header-anchor">#</a> volumes</h3> <p>数据卷所挂载路径设置。可以设置宿主机路径 （HOST:CONTAINER） 或加上访问模式 （HOST:CONTAINER:ro）。</p> <p>该指令中路径支持相对路径。</p> <div class="language-haml extra-class"><pre class="language-haml"><code>volumes:
 <span class="token punctuation">-</span><span class="token code"> <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql</span>
 <span class="token punctuation">-</span><span class="token code"> cache<span class="token operator">/</span><span class="token punctuation">:</span><span class="token operator">/</span>tmp<span class="token operator">/</span>cache</span>
 <span class="token punctuation">-</span><span class="token code"> <span class="token operator">~</span><span class="token operator">/</span>configs<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>configs<span class="token operator">/</span><span class="token symbol">:ro</span></span>
</code></pre></div><h1 id="其它指令"><a href="#其它指令" aria-hidden="true" class="header-anchor">#</a> 其它指令</h1> <p>此外，还有包括 domainname, entrypoint, hostname, ipc, mac_address, privileged, read_only, shm_size, restart, stdin_open, tty, user, working_dir 等指令，基本跟 docker run 中对应参数的功能一致。</p> <p>指定服务容器启动后执行的入口文件。</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>entrypoint<span class="token punctuation">:</span> <span class="token string regex">/code/</span>entrypoint<span class="token operator">.</span>sh
</code></pre></div><p>指定容器中运行应用的用户名。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>user: nginx
</code></pre></div><p>指定容器中工作目录。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>working_dir: /code
</code></pre></div><p>指定容器中搜索域名、主机名、mac 地址等。</p> <div class="language-subunit extra-class"><pre class="language-text"><code>domainname: your_website.com
hostname: test
mac_address: 08-00-27-00-0C-0A
</code></pre></div><p>允许容器中运行一些特权命令。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>指定容器退出后的重启策略为始终重启。该命令对保持服务始终运行十分有效，在生产环境中推荐配置为 always 或者 unless-stopped。</p> <div class="language-avrasm extra-class"><pre class="language-text"><code>restart: always
</code></pre></div><p>以只读模式挂载容器的 root 文件系统，意味着不能对容器内容进行修改。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">read_only</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>打开标准输入，可以接受外部输入。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">stdin_open</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>模拟一个伪终端。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h3 id="读取变量"><a href="#读取变量" aria-hidden="true" class="header-anchor">#</a> 读取变量</h3> <p>Compose 模板文件支持动态读取主机的系统环境变量和当前目录下的 .env 文件中的变量。</p> <p>例如，下面的 Compose 文件将从运行它的环境中读取变量 ${MONGO_VERSION} 的值，并写入执行的指令中。</p> <div class="language-dts extra-class"><pre class="language-text"><code>version: &quot;3&quot;
services:

db:
  image: &quot;mongo:${MONGO_VERSION}&quot;
</code></pre></div><p>如果执行 MONGO_VERSION=3.2 docker-compose up 则会启动一个 mongo:3.2 镜像的容器；如果执行 MONGO_VERSION=2.8 docker-compose up 则会启动一个 mongo:2.8 镜像的容器。</p> <p>若当前目录存在 .env 文件，执行 docker-compose 命令时将从该文件中读取变量。</p> <p>在当前目录新建 .env 文件并写入以下内容。</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token comment"># 支持 # 号注释</span>
MONGO_VERSION<span class="token operator">=</span>3.6
</code></pre></div><p>执行 docker-compose up 则会启动一个 mongo:3.6 镜像的容器。</p> <h2 id="_6-docker-compose-实战"><a href="#_6-docker-compose-实战" aria-hidden="true" class="header-anchor">#</a> 6. docker-compose 实战</h2> <h3 id="docker-compose-mysql5-7-yml"><a href="#docker-compose-mysql5-7-yml" aria-hidden="true" class="header-anchor">#</a> docker-compose-mysql5.7.yml</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.22
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3308</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span><span class="token punctuation">-</span>character<span class="token punctuation">-</span>set<span class="token punctuation">-</span>server=utf8mb4
      <span class="token punctuation">-</span><span class="token punctuation">-</span>collation<span class="token punctuation">-</span>server=utf8mb4_general_ci
      <span class="token punctuation">-</span><span class="token punctuation">-</span>explicit_defaults_for_timestamp=true
      <span class="token punctuation">-</span><span class="token punctuation">-</span>lower_case_table_names=1
      <span class="token punctuation">-</span><span class="token punctuation">-</span>max_allowed_packet=128M
      <span class="token punctuation">-</span><span class="token punctuation">-</span>sql<span class="token punctuation">-</span>mode=&quot;STRICT_TRANS_TABLES<span class="token punctuation">,</span>NO_AUTO_CREATE_USER<span class="token punctuation">,</span>NO_ENGINE_SUBSTITUTION<span class="token punctuation">,</span>NO_ZERO_DATE<span class="token punctuation">,</span>NO_ZERO_IN_DATE<span class="token punctuation">,</span>ERROR_FOR_DIVISION_BY_ZERO&quot;
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/var/lib/mysql

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql-data</span><span class="token punctuation">:</span>
</code></pre></div><h3 id="docker-compose-mysql5-8-yml"><a href="#docker-compose-mysql5-8-yml" aria-hidden="true" class="header-anchor">#</a> docker-compose-mysql5.8.yml</h3> <div class="language-YAML extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span><span class="token punctuation">-</span>default<span class="token punctuation">-</span>authentication<span class="token punctuation">-</span>plugin=mysql_native_password
      <span class="token punctuation">-</span><span class="token punctuation">-</span>character<span class="token punctuation">-</span>set<span class="token punctuation">-</span>server=utf8mb4
      <span class="token punctuation">-</span><span class="token punctuation">-</span>collation<span class="token punctuation">-</span>server=utf8mb4_general_ci
      <span class="token punctuation">-</span><span class="token punctuation">-</span>explicit_defaults_for_timestamp=true
      <span class="token punctuation">-</span><span class="token punctuation">-</span>lower_case_table_names=1
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3309</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./data<span class="token punctuation">:</span>/var/lib/mysql

  <span class="token key atrule">adminer</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">8080</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间: </span> <span class="time">7/21/2019, 11:47:17 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.3295d756.js" defer></script><script src="/assets/js/8.beb2bf5d.js" defer></script><script src="/assets/js/10.38c467ad.js" defer></script>
  </body>
</html>
