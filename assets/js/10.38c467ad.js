(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{308:function(s,t,a){s.exports=a.p+"assets/img/1563674617938.ebebc7ae.png"},352:function(s,t,a){"use strict";a.r(t);var e=[function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"content"},[e("h2",{attrs:{id:"_1-什么是-docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是-docker-compose","aria-hidden":"true"}},[s._v("#")]),s._v(" 1. 什么是 Docker Compose")]),s._v(" "),e("p",[e("img",{attrs:{src:a(308),alt:"enter description here"}})]),s._v(" "),e("p",[s._v("Docker Compose 是 Docker 官方编排（Orchestration）项目之一，负责快速的部署分布式应用。")]),s._v(" "),e("h2",{attrs:{id:"_2-docker-compose-简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker-compose-简介","aria-hidden":"true"}},[s._v("#")]),s._v(" 2. Docker Compose 简介")]),s._v(" "),e("p",[s._v("Compose 项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟 OpenStack 中的 Heat 十分类似。\n其代码目前在 https://github.com/docker/compose 上开源。")]),s._v(" "),e("p",[s._v("Compose 定位是 「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」，其前身是开源项目 Fig。")]),s._v(" "),e("p",[s._v("我们知道使用一个 Dockerfile 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。")]),s._v(" "),e("p",[s._v("Compose 恰好满足了这样的需求。它允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。")]),s._v(" "),e("p",[s._v("Compose 中有两个重要的概念：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("服务（service）：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。")])]),s._v(" "),e("li",[e("p",[s._v("项目（project）：由一组关联的应用容器组成的一个完成业务单元，在docker-compose.yml中定义。")])])]),s._v(" "),e("p",[s._v("以上可以理解为：\n服务（service）就是在它下面可以定义应用需要的一些服务，代表配置文件中的每一项服务。每个服务都有自己的名字、使用的镜像、挂载的数据卷、所属的网络、依赖哪些其他服务等等，即以容器为粒度，用户需要Compose所完成的任务。")]),s._v(" "),e("p",[s._v("项目（project）代表用户需要完成的一个项目，即是Compose的一个配置文件可以解析为一个项目，即Compose通过分析指定配置文件，得出配置文件所需完成的所有容器管理与部署操作。")]),s._v(" "),e("p",[s._v("Compose 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。")]),s._v(" "),e("p",[s._v("Compose 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 Compose 来进行编排管理。")]),s._v(" "),e("h2",{attrs:{id:"_3-docker-compose-安装与卸载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-docker-compose-安装与卸载","aria-hidden":"true"}},[s._v("#")]),s._v(" 3. Docker Compose 安装与卸载")]),s._v(" "),e("p",[s._v("Compose 支持 Linux、macOS、Windows 10 三大平台。")]),s._v(" "),e("p",[s._v("Compose 可以通过 Python 的包管理工具 pip 进行安装，也可以直接下载编译好的二进制文件使用，甚至能够直接在 Docker 容器中运行。")]),s._v(" "),e("p",[s._v("前两种方式是传统方式，适合本地环境下安装使用；最后一种方式则不破坏系统环境，更适合云计算场景。")]),s._v(" "),e("p",[s._v("Docker for Mac 、Docker for Windows 自带 docker-compose 二进制文件，安装 Docker 之后可以直接使用。")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("version\ndocker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose version "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.24")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" build "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4667896")]),s._v("b\n\n")])])]),e("p",[s._v("Linux 系统请使用以下介绍的方法安装。")]),s._v(" "),e("ul",[e("li",[s._v("二进制包")])]),s._v(" "),e("p",[s._v("在 Linux 上的也安装十分简单，从 官方 GitHub Release 处直接下载编译好的二进制文件即可。")]),s._v(" "),e("p",[s._v("例如，在 Linux 64 位系统上直接下载对应的二进制包。")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("curl "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("L")]),s._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("compose"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("releases"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("download"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.24")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("`uname -s`")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[s._v("`uname -m`")])]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\nchmod "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\n")])])]),e("ul",[e("li",[s._v("PIP 安装")])]),s._v(" "),e("p",[s._v("注： x86_64 架构的 Linux 建议按照上边的方法下载二进制包进行安装，如果您计算机的架构是 ARM (例如，树莓派)，再使用 pip 安装。")]),s._v(" "),e("p",[s._v("这种方式是将 Compose 当作一个 Python 应用来从 pip 源中安装。")]),s._v(" "),e("p",[s._v("执行安装命令：")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("sudo pip install "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("U")]),s._v(" docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\n")])])]),e("ul",[e("li",[s._v("容器中执行")])]),s._v(" "),e("p",[s._v("Compose 既然是一个 Python 应用，自然也可以直接用容器来执行它。")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v(" curl "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("L")]),s._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("compose"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("releases"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("download"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.24")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\n chmod "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("x "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\n")])])]),e("p",[s._v("实际上，查看下载的 run.sh 脚本内容，如下")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("#"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sh\n#\n# Run docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a container\n#\n# This script will attempt to mirror the host paths by using volumes "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the\n# following paths"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n#   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pwd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n#   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dirname $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPOSE_FILE")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" it's "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v("\n#   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" it's "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v("\n#\n# You can add additional "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("volumes")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("or any docker run options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" using\n# the $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPOSE_OPTIONS")]),s._v(" environment variable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n#\n\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e\n\n"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.24.1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IMAGE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker/compose:$VERSION"')]),s._v("\n\n\n# Setup options "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" connecting to docker host\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("z "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$DOCKER_HOST"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCKER_HOST")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/run/docker.sock"')]),s._v("\nfi\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$DOCKER_HOST"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCKER_ADDR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-v $DOCKER_HOST:$DOCKER_HOST -e DOCKER_HOST"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCKER_ADDR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-e DOCKER_HOST -e DOCKER_TLS_VERIFY -e DOCKER_CERT_PATH"')]),s._v("\nfi\n\n\n# Setup volume mounts "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" compose config and context\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$(pwd)"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VOLUMES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-v $(pwd):$(pwd)"')]),s._v("\nfi\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$COMPOSE_FILE"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPOSE_OPTIONS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$COMPOSE_OPTIONS -e COMPOSE_FILE=$COMPOSE_FILE"')]),s._v("\n    compose_dir"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("realpath "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dirname $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPOSE_FILE")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfi\n# "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TODO")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" also check "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("file argument\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$compose_dir"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VOLUMES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$VOLUMES -v $compose_dir:$compose_dir"')]),s._v("\nfi\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$HOME"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VOLUMES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$VOLUMES -v $HOME:$HOME -v $HOME:/root"')]),s._v(" # mount $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root to share docker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config\nfi\n\n# Only allocate tty "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" we detect one\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n        "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCKER_RUN_OPTIONS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$DOCKER_RUN_OPTIONS -t"')]),s._v("\nfi\n\n# Always "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i to support piped and terminal input "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" run"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("exec\n"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCKER_RUN_OPTIONS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$DOCKER_RUN_OPTIONS -i"')]),s._v("\n\n\n# Handle userns security\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("z "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$(docker info 2>/dev/null | grep userns)"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" then\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCKER_RUN_OPTIONS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$DOCKER_RUN_OPTIONS --userns=host"')]),s._v("\nfi\n\nexec docker run "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("rm $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCKER_RUN_OPTIONS")]),s._v(" $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DOCKER_ADDR")]),s._v(" $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMPOSE_OPTIONS")]),s._v(" $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VOLUMES")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$(pwd)"')]),s._v(" $"),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IMAGE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$@"')]),s._v("\n\n\n")])])]),e("p",[s._v("可以看到，它其实是下载了 docker/compose 镜像并运行。")]),s._v(" "),e("ul",[e("li",[s._v("卸载\n如果是二进制包方式安装的，删除二进制文件即可。")])]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("rm "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\n\n")])])]),e("p",[s._v("如果是通过 pip 安装的，则执行如下命令即可删除。")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("pip uninstall docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\n")])])]),e("h2",{attrs:{id:"_4-compose常用命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-compose常用命令","aria-hidden":"true"}},[s._v("#")]),s._v(" 4. Compose常用命令")]),s._v(" "),e("p",[s._v("在我们使用Compose前，可以通过执行docker-compose --help|-h来查看Compose基本命令用法。")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("efine and run multi"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("container applications "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" Docker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\nUsage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("arg"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMAND")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ARGS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("help\n\nOptions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("file "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FILE")]),s._v("             Specify an alternate compose "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n                              "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("project"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("     Specify an alternate project "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("name")]),s._v("\n                              "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" directory name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("verbose                   Show more output\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("log"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("level "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LEVEL")]),s._v("           Set log "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("level")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DEBUG")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WARNING")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ERROR")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CRITICAL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("no"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ansi                   Do not print "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ANSI")]),s._v(" control characters\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("version               Print version and exit\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("H")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("host "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOST")]),s._v("             Daemon socket to connect to\n\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tls                       Use "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" implied by "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tlsverify\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tlscacert "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA_PATH")]),s._v("         Trust certs signed only by "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tlscert "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLIENT_CERT_PATH")]),s._v("  Path to "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),s._v(" certificate file\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tlskey "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS_KEY_PATH")]),s._v("       Path to "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),s._v(" key file\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tlsverify                 Use "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),s._v(" and verify the remote\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("skip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("check       Don"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t check the daemon'")]),s._v("s hostname against the\n                              name specified "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the client certificate\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("project"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("directory "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PATH")]),s._v("    Specify an alternate working "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("directory")]),s._v("\n                              "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" the path "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" the Compose file"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("compatibility             If "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Compose will attempt to convert keys\n                              "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v3 files to their non"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Swarm equivalent\n\nCommands"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  build              Build or rebuild services\n  bundle             Generate a Docker bundle "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" the Compose file\n  config             Validate and view the Compose file\n  create             Create services\n  down               Stop and remove containers"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" networks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" images"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" and volumes\n  events             Receive real time events "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" containers\n  exec               Execute a command "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a running container\n  help               Get help on a command\n  images             List images\n  kill               Kill containers\n  logs               View output "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" containers\n  pause              Pause services\n  port               Print the "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" port "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a port binding\n  ps                 List containers\n  pull               Pull service images\n  push               Push service images\n  restart            Restart services\n  rm                 Remove stopped containers\n  run                Run a one"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("off command\n  scale              Set number "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" containers "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a service\n  start              Start services\n  stop               Stop services\n  top                Display the running processes\n  unpause            Unpause services\n  up                 Create and start containers\n  version            Show the Docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Compose version information\n")])])]),e("p",[s._v("我们也可以通过执行docker-compose [COMMAND] --help或者docker-compose --help [COMMAND]来查看某个具体的使用格式。")]),s._v(" "),e("p",[s._v("从上面的提示中我们可以知道Compose命令的基本的使用格式为：")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("arg"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COMMAND")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ARGS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),e("p",[s._v("命令选项如下：")]),s._v(" "),e("ul",[e("li",[s._v("-f，–file FILE指定使用的Compose模板文件，默认为docker-compose.yml，可以多次指定。")]),s._v(" "),e("li",[s._v("-p，–project-name NAME指定项目名称，默认将使用所在目录名称作为项目名。")]),s._v(" "),e("li",[s._v("-x-network-driver 使用Docker的可拔插网络后端特性（需要Docker 1.9 及以后版本）")]),s._v(" "),e("li",[s._v("-x-network-driver DRIVER指定网络后端的驱动，默认为bridge（需要Docker 1.9 及以后版本）")]),s._v(" "),e("li",[s._v("-verbose输出更多调试信息")]),s._v(" "),e("li",[s._v("-v，–version打印版本并退出")])]),s._v(" "),e("p",[s._v("Docker Compose常用命令列表如下：")]),s._v(" "),e("p",[s._v("build\t构建项目中的服务容器\nhelp\t获得一个命令的帮助\nkill\t通过发送SIGKILL信号来强制停止服务容器\nconfig\t验证和查看compose文件配置\ncreate\t为服务创建容器。只是单纯的create，还需要使用start启动compose\ndown\t停止并删除容器，网络，镜像和数据卷\nexec\t在运行的容器中执行一个命令\nlogs\t查看服务容器的输出\npause\t暂停一个服务容器\nport\t打印某个容器端口所映射的公共端口\nps\t列出项目中目前的所有容器\npull\t拉取服务依赖的镜像\npush\t推送服务镜像\nrestart\t重启项目中的服务\nrm\t删除所有（停止状态的）服务容器\nrun\t在指定服务上执行一个命令\nscale\t设置指定服务运行的容器个数\nstart\t启动已经存在的服务容器\nstop\t停止已经处于运行状态的容器，但不删除它\ntop\t显示运行的进程\nunpause\t恢复处于暂停状态中的服务\nup\t自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作\nversion\t打印版本信息")]),s._v(" "),e("p",[s._v("命令详解：")]),s._v(" "),e("h3",{attrs:{id:"_1、build构建项目中的服务容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、build构建项目中的服务容器","aria-hidden":"true"}},[s._v("#")]),s._v(" 1、build\t构建项目中的服务容器")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose build "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("build"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("arg key"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("val"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SERVICE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),e("p",[s._v("构建（重新构建）项目中的服务容器。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("–compress 通过gzip压缩构建上下环境")]),s._v(" "),e("li",[s._v("–force-rm 删除构建过程中的临时容器")]),s._v(" "),e("li",[s._v("–no-cache 构建镜像过程中不使用缓存")]),s._v(" "),e("li",[s._v("–pull 始终尝试通过拉取操作来获取更新版本的镜像")]),s._v(" "),e("li",[s._v("-m, --memory MEM 为构建的容器设置内存大小")]),s._v(" "),e("li",[s._v("–build-arg key=val 为服务设置build-time变量")])]),s._v(" "),e("h3",{attrs:{id:"_2、help获得一个命令的帮助"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、help获得一个命令的帮助","aria-hidden":"true"}},[s._v("#")]),s._v(" 2、help\t获得一个命令的帮助")]),s._v(" "),e("p",[s._v("获得一个命令的帮助。")]),s._v(" "),e("h3",{attrs:{id:"_3、kill通过发送sigkill信号来强制停止服务容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、kill通过发送sigkill信号来强制停止服务容器","aria-hidden":"true"}},[s._v("#")]),s._v(" 3、kill\t通过发送SIGKILL信号来强制停止服务容器")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose kill "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SERVICE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),e("p",[s._v("通过发送SIGKILL信号来强制停止服务容器。\n支持通过-s参数来指定发送的信号，例如通过如下指令发送SIGINT信号：")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose kill "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),e("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIGINT")]),s._v("\n")])])]),e("h3",{attrs:{id:"_4、config验证和查看compose文件配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、config验证和查看compose文件配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 4、config\t验证和查看compose文件配置")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-gams extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose config [options]\n")])])]),e("p",[s._v("验证并查看compose文件配置。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("–resolve-image-digests 将镜像标签标记为摘要")]),s._v(" "),e("li",[s._v("-q, --quiet 只验证配置，不输出。 当配置正确时，不输出任何内容，当文件配置错误，输出错误信息")]),s._v(" "),e("li",[s._v("–services 打印服务名，一行一个")]),s._v(" "),e("li",[s._v("–volumes 打印数据卷名，一行一个")])]),s._v(" "),e("h3",{attrs:{id:"_5、create为服务创建容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、create为服务创建容器","aria-hidden":"true"}},[s._v("#")]),s._v(" 5、create\t为服务创建容器")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose create")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("为服务创建容器.只是单纯的create，还需要使用start启动compose。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("–force-recreate 重新创建容器，即使它的配置和镜像没有改变，不兼容–no-recreate参数")]),s._v(" "),e("li",[s._v("–no-recreate 如果容器已经存在，不需要重新创建. 不兼容–force-recreate参数")]),s._v(" "),e("li",[s._v("–no-build 不创建镜像，即使缺失")]),s._v(" "),e("li",[s._v("–build 创建容器前，生成镜像")])]),s._v(" "),e("h3",{attrs:{id:"_6、down停止并删除容器，网络，镜像和数据卷"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、down停止并删除容器，网络，镜像和数据卷","aria-hidden":"true"}},[s._v("#")]),s._v(" 6、down\t停止并删除容器，网络，镜像和数据卷")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-gams extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose down [options]\n")])])]),e("p",[s._v("停止和删除容器、网络、卷、镜像，这些内容是通过docker-compose up命令创建的. 默认值删除 容器 网络，可以通过指定 rmi 、volumes参数删除镜像和卷。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("–rmi type 删除镜像，类型必须是: ‘all’: 删除compose文件中定义的所以镜像；‘local’: 删除镜像名为空的镜像")]),s._v(" "),e("li",[s._v("-v, --volumes 删除已经在compose文件中定义的和匿名的附在容器上的数据卷")]),s._v(" "),e("li",[s._v("–remove-orphans 删除服务中没有在compose中定义的容器")])]),s._v(" "),e("h3",{attrs:{id:"_7、exec-在运行的容器中执行一个命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7、exec-在运行的容器中执行一个命令","aria-hidden":"true"}},[s._v("#")]),s._v(" 7、exec 在运行的容器中执行一个命令")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker exec")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("SERVICE COMMAND")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[ARGS...]")]),s._v("\n")])])]),e("p",[s._v("与docker exec命令功能相同，可以通过service name登陆到容器中。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("-d 分离模式，后台运行命令.")]),s._v(" "),e("li",[s._v("–privileged 获取特权.")]),s._v(" "),e("li",[s._v("–user USER 指定运行的用户.")]),s._v(" "),e("li",[s._v("-T 禁用分配TTY. By default docker-compose exec分配 a TTY.")]),s._v(" "),e("li",[s._v("–index=index 当一个服务拥有多个容器时，可通过该参数登陆到该服务下的任何服务，例如：docker-compose exec --index=1 web /bin/bash ，web服务中包含多个容器")])]),s._v(" "),e("h3",{attrs:{id:"_8、logs-查看服务容器的输出"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8、logs-查看服务容器的输出","aria-hidden":"true"}},[s._v("#")]),s._v(" 8、logs 查看服务容器的输出")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose logs")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("查看服务容器的输出。默认情况下，docker-compose将对不同的服务输出使用不同的颜色来区分。可以通过–no-color来关闭颜色。")]),s._v(" "),e("h3",{attrs:{id:"_9、pause-暂停一个服务容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9、pause-暂停一个服务容器","aria-hidden":"true"}},[s._v("#")]),s._v(" 9、pause 暂停一个服务容器")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-scilab extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose pause [SERVICE...]\n")])])]),e("p",[s._v("暂停一个服务容器。")]),s._v(" "),e("h3",{attrs:{id:"_10、port-打印某个容器端口所映射的公共端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10、port-打印某个容器端口所映射的公共端口","aria-hidden":"true"}},[s._v("#")]),s._v(" 10、port 打印某个容器端口所映射的公共端口")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-gams extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose port [options] SERVICE PRIVATE_PORT\n")])])]),e("p",[s._v("显示某个容器端口所映射的公共端口。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("–protocol=proto 指定端口协议，TCP（默认值）或者UDP")]),s._v(" "),e("li",[s._v("–index=index 如果同意服务存在多个容器，指定命令对象容器的序号（默认为1）")])]),s._v(" "),e("h3",{attrs:{id:"_11、ps-列出项目中目前的所有容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11、ps-列出项目中目前的所有容器","aria-hidden":"true"}},[s._v("#")]),s._v(" 11、ps 列出项目中目前的所有容器")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose ps")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("列出项目中目前的所有容器。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("-q 只打印容器的ID信息")])]),s._v(" "),e("h3",{attrs:{id:"_12、pull-拉取服务依赖的镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_12、pull-拉取服务依赖的镜像","aria-hidden":"true"}},[s._v("#")]),s._v(" 12、pull 拉取服务依赖的镜像")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose pull")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("拉取服务依赖的镜像。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("–ignore-pull-failures 忽略拉取镜像过程中的错误")]),s._v(" "),e("li",[s._v("–parallel 多个镜像同时拉取")]),s._v(" "),e("li",[s._v("–quiet 拉取镜像过程中不打印进度信息")])]),s._v(" "),e("h3",{attrs:{id:"_13、push-推送服务镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_13、push-推送服务镜像","aria-hidden":"true"}},[s._v("#")]),s._v(" 13、push 推送服务镜像")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose push")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("推送服务依的镜像。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("–ignore-push-failures 忽略推送镜像过程中的错误")])]),s._v(" "),e("h3",{attrs:{id:"_14、restart-重启项目中的服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_14、restart-重启项目中的服务","aria-hidden":"true"}},[s._v("#")]),s._v(" 14、restart 重启项目中的服务")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose restart")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("重启项目中的服务。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("-t, --timeout TIMEOUT 指定重启前停止容器的超时（默认为10秒）")])]),s._v(" "),e("h3",{attrs:{id:"_15、rm-删除所有（停止状态的）服务容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_15、rm-删除所有（停止状态的）服务容器","aria-hidden":"true"}},[s._v("#")]),s._v(" 15、rm 删除所有（停止状态的）服务容器")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose rm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("删除所有（停止状态的）服务容器。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("–f, --force 强制直接删除，包括非停止状态的容器")]),s._v(" "),e("li",[s._v("-v 删除容器所挂载的数据卷")])]),s._v(" "),e("h3",{attrs:{id:"_16、run-在指定服务上执行一个命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_16、run-在指定服务上执行一个命令","aria-hidden":"true"}},[s._v("#")]),s._v(" 16、run 在指定服务上执行一个命令")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose run")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[-v VOLUME...]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[-p PORT...]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[-e KEY=VAL...]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("SERVICE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[COMMAND]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[ARGS...]")]),s._v("\n")])])]),e("p",[s._v("在指定服务上执行一个命令。")]),s._v(" "),e("p",[s._v("例如：")]),s._v(" "),e("div",{staticClass:"language-stylus extra-class"},[e("pre",{pre:!0,attrs:{class:"language-stylus"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property-declaration"}},[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("docker-compose")]),s._v(" run ubuntu ping www"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("anumbrella"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("net")]),s._v("\n")])])]),e("p",[s._v("将会执行一个ubuntu容器，并执行ping www.anumbrella.net命令。")]),s._v(" "),e("p",[s._v("默认情况下，如果存在关联，则所有关联的服务将会自动被启动，除非这些服务已经在运行中。该命令类似于启动容器后运行指定的命令，相关卷、链接等都会按照配置自动创建。有两个不同点：")]),s._v(" "),e("p",[s._v("给定命令将会覆盖原有的自动运行命令\n不会自动创建端口，以避免冲突\n如果不希望自动启动关联的容器，可以使用–no-deps选项，例如：")]),s._v(" "),e("div",{staticClass:"language-stata extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose run --no-deps web\n")])])]),e("p",[s._v("将不会启动web容器关联的其他容器。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("-d 在后台运行服务容器")]),s._v(" "),e("li",[s._v("–name NAME 为容器指定一个名字")]),s._v(" "),e("li",[s._v("–entrypoint CMD 覆盖默认的容器启动指令")]),s._v(" "),e("li",[s._v("-e KEY=VAL 设置环境变量值，可多次使用选项来设置多个环境变量")]),s._v(" "),e("li",[s._v('-u, --user="" 指定运行容器的用户名或者uid')]),s._v(" "),e("li",[s._v("–no-deps 不自动启动管理的服务容器")]),s._v(" "),e("li",[s._v("–rm 运行命令后自动删除容器，d模式下将忽略")]),s._v(" "),e("li",[s._v("-p, --publish=[] 映射容器端口到本地主机")]),s._v(" "),e("li",[s._v("–service-ports 配置服务端口并映射到本地主机")]),s._v(" "),e("li",[s._v("-v, --volume=[] 绑定一个数据卷，默认为空")]),s._v(" "),e("li",[s._v("T 不分配伪tty，意味着依赖tty的指令将无法运行")]),s._v(" "),e("li",[s._v('-w, --workdir="" 为容器指定默认工作目录')])]),s._v(" "),e("h3",{attrs:{id:"_17、scale-设置指定服务运行的容器个数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_17、scale-设置指定服务运行的容器个数","aria-hidden":"true"}},[s._v("#")]),s._v(" 17、scale 设置指定服务运行的容器个数")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose scale")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE=NUM...]")]),s._v("\n")])])]),e("p",[s._v("设置指定服务运行的容器个数。\n通过service=num的参数来设置数量。例如：")]),s._v(" "),e("div",{staticClass:"language-lsl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose scale web=3 db=2\n")])])]),e("p",[s._v("将启动3个容器运行web服务，2个容器运行db服务。一般情况下，当指定书目多于该服务当前实际运行容器，将新创建并启动容器；反之，将停止容器。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("-t, --timeout TIMEOUT 停止容器时候的超时（默认为10秒）")])]),s._v(" "),e("h3",{attrs:{id:"_18、start-启动已经存在的服务容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_18、start-启动已经存在的服务容器","aria-hidden":"true"}},[s._v("#")]),s._v(" 18、start 启动已经存在的服务容器")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose start")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("启动已经存在的服务容器。")]),s._v(" "),e("h3",{attrs:{id:"_19、stop-停止已经处于运行状态的容器，但不删除它"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_19、stop-停止已经处于运行状态的容器，但不删除它","aria-hidden":"true"}},[s._v("#")]),s._v(" 19、stop 停止已经处于运行状态的容器，但不删除它")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose stop")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("停止已经处于运行状态的容器，但不删除它。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("-t, --timeout TIMEOUT 停止容器时候的超时（默认为10秒）")])]),s._v(" "),e("h3",{attrs:{id:"_20、top-显示运行的进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_20、top-显示运行的进程","aria-hidden":"true"}},[s._v("#")]),s._v(" 20、top 显示运行的进程")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose stop")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("显示各个容器运行的进程情况。")]),s._v(" "),e("h3",{attrs:{id:"_21、unpause-恢复处于暂停状态中的服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_21、unpause-恢复处于暂停状态中的服务","aria-hidden":"true"}},[s._v("#")]),s._v(" 21、unpause 恢复处于暂停状态中的服务")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose unpause")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("恢复处于暂停状态中的服务。")]),s._v(" "),e("h3",{attrs:{id:"_22、up-自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_22、up-自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作","aria-hidden":"true"}},[s._v("#")]),s._v(" 22、up 自动完成包括构建镜像、创建服务、启动服务并关闭关联服务相关容器的一些列操作")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-inform7 extra-class"},[e("pre",{pre:!0,attrs:{class:"language-inform7"}},[e("code",[e("span",{pre:!0,attrs:{class:"token text comment"}},[s._v("docker-compose")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token position keyword"}},[s._v("up")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[options]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[--scale SERVICE=NUM...]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("[SERVICE...]")]),s._v("\n")])])]),e("p",[s._v("up命令十分强大，它尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一些列操作。链接的服务都将会被自动启动，除非已经处于运行状态。")]),s._v(" "),e("p",[s._v("多数情况下我们可以直接通过该命令来启动一个项目。")]),s._v(" "),e("p",[s._v("选项包括：")]),s._v(" "),e("ul",[e("li",[s._v("-d 在后台运行服务容器")]),s._v(" "),e("li",[s._v("–no-color 不使用颜色来区分不同的服务的控制输出")]),s._v(" "),e("li",[s._v("–no-deps 不启动服务所链接的容器")]),s._v(" "),e("li",[s._v("–force-recreate 强制重新创建容器，不能与–no-recreate同时使用")]),s._v(" "),e("li",[s._v("–no-recreate 如果容器已经存在，则不重新创建，不能与–force-recreate同时使用")]),s._v(" "),e("li",[s._v("–no-build 不自动构建缺失的服务镜像")]),s._v(" "),e("li",[s._v("–build 在启动容器前构建服务镜像")]),s._v(" "),e("li",[s._v("–abort-on-container-exit 停止所有容器，如果任何一个容器被停止，不能与-d同时使用")]),s._v(" "),e("li",[s._v("-t, --timeout TIMEOUT 停止容器时候的超时（默认为10秒）")]),s._v(" "),e("li",[s._v("–remove-orphans 删除服务中没有在compose文件中定义的容器")]),s._v(" "),e("li",[s._v("–scale SERVICE=NUM 设置服务运行容器的个数，将覆盖在compose中通过scale指定的参数")])]),s._v(" "),e("h3",{attrs:{id:"_23、version-打印版本信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_23、version-打印版本信息","aria-hidden":"true"}},[s._v("#")]),s._v(" 23、version 打印版本信息")]),s._v(" "),e("p",[s._v("格式为：")]),s._v(" "),e("div",{staticClass:"language-d extra-class"},[e("pre",{pre:!0,attrs:{class:"language-d"}},[e("code",[s._v("docker"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("version")]),s._v("\n")])])]),e("h2",{attrs:{id:"_5-compose模板文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-compose模板文件","aria-hidden":"true"}},[s._v("#")]),s._v(" 5. Compose模板文件")]),s._v(" "),e("p",[s._v("模板文件是使用 Compose 的核心，涉及到的指令关键字也比较多。但大家不用担心，这里面大部分指令跟 docker run 相关参数的含义都是类似的。")]),s._v(" "),e("p",[s._v("默认的模板文件名称为 docker-compose.yml，格式为 YAML 格式。")]),s._v(" "),e("div",{staticClass:"language-dts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('version: "3"\n\nservices:\n  webapp:\n    image: examples/web\n    ports:\n      - "80:80"\n    volumes:\n      - "/data"\n')])])]),e("p",[s._v("注意每个服务都必须通过 image 指令指定镜像或 build 指令（需要 Dockerfile）等来自动构建生成镜像。")]),s._v(" "),e("p",[s._v("如果使用 build 指令，在 Dockerfile 中设置的选项(例如：CMD, EXPOSE, VOLUME, ENV 等) 将会自动被获取，无需在 docker-compose.yml 中再次设置。")]),s._v(" "),e("p",[s._v("下面分别介绍各个指令的用法。")]),s._v(" "),e("h3",{attrs:{id:"build"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#build","aria-hidden":"true"}},[s._v("#")]),s._v(" build")]),s._v(" "),e("p",[s._v("指定 Dockerfile 所在文件夹的路径（可以是绝对路径，或者相对 docker-compose.yml 文件的路径）。 Compose 将会利用它自动构建这个镜像，然后使用这个镜像。")]),s._v(" "),e("div",{staticClass:"language-dts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '3'\nservices:\n\n  webapp:\n    build: ./dir\n")])])]),e("p",[s._v("你也可以使用 context 指令指定 Dockerfile 所在文件夹的路径。")]),s._v(" "),e("p",[s._v("使用 dockerfile 指令指定 Dockerfile 文件名。")]),s._v(" "),e("p",[s._v("使用 arg 指令指定构建镜像时的变量。")]),s._v(" "),e("div",{staticClass:"language-dts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '3'\nservices:\n\n  webapp:\n    build:\n      context: ./dir\n      dockerfile: Dockerfile-alternate\n      args:\n        buildno: 1\n")])])]),e("p",[s._v("使用 cache_from 指定构建镜像的缓存")]),s._v(" "),e("div",{staticClass:"language-less extra-class"},[e("pre",{pre:!0,attrs:{class:"language-less"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("context")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("cache_from")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("alpine")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" corp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("web_app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3.14\n")])])]),e("h3",{attrs:{id:"cap-add-cap-drop"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cap-add-cap-drop","aria-hidden":"true"}},[s._v("#")]),s._v(" cap_add, cap_drop")]),s._v(" "),e("p",[s._v("指定容器的内核能力（capacity）分配。")]),s._v(" "),e("p",[s._v("例如，让容器拥有所有能力可以指定为：")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cap_add:\n  - ALL\n")])])]),e("p",[s._v("去掉 NET_ADMIN 能力可以指定为：")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cap_drop:\n  - NET_ADMIN\n")])])]),e("h3",{attrs:{id:"command"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#command","aria-hidden":"true"}},[s._v("#")]),s._v(" command")]),s._v(" "),e("p",[s._v("覆盖容器启动后默认执行的命令。")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("command: "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),s._v("\n")])])]),e("h3",{attrs:{id:"configs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configs","aria-hidden":"true"}},[s._v("#")]),s._v(" configs")]),s._v(" "),e("p",[s._v("仅用于 Swarm mode")]),s._v(" "),e("h3",{attrs:{id:"cgroup-parent"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cgroup-parent","aria-hidden":"true"}},[s._v("#")]),s._v(" cgroup_parent")]),s._v(" "),e("p",[s._v("指定父 cgroup 组，意味着将继承该组的资源限制。")]),s._v(" "),e("p",[s._v("例如，创建了一个 cgroup 组名称为 cgroups_1。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cgroup_parent: cgroups_1\n")])])]),e("h3",{attrs:{id:"container-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#container-name","aria-hidden":"true"}},[s._v("#")]),s._v(" container_name")]),s._v(" "),e("p",[s._v("指定容器名称。默认将会使用 项目名称_服务名称_序号 这样的格式。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("container_name: docker-web-container\n")])])]),e("p",[s._v("注意: 指定容器名称后，该服务将无法进行扩展（scale），因为 Docker 不允许多个容器具有相同的名称。")]),s._v(" "),e("h3",{attrs:{id:"deploy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deploy","aria-hidden":"true"}},[s._v("#")]),s._v(" deploy")]),s._v(" "),e("p",[s._v("仅用于 Swarm mode")]),s._v(" "),e("h3",{attrs:{id:"devices"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#devices","aria-hidden":"true"}},[s._v("#")]),s._v(" devices")]),s._v(" "),e("p",[s._v("指定设备映射关系。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('devices:\n  - "/dev/ttyUSB1:/dev/ttyUSB0"\n')])])]),e("h3",{attrs:{id:"depends-on"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#depends-on","aria-hidden":"true"}},[s._v("#")]),s._v(" depends_on")]),s._v(" "),e("p",[s._v("解决容器的依赖、启动先后的问题。以下例子中会先启动 redis db 再启动 web")]),s._v(" "),e("div",{staticClass:"language-dts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '3'\n\nservices:\n  web:\n    build: .\n    depends_on:\n      - db\n      - redis\n\n  redis:\n    image: redis\n\n  db:\n    image: postgres\n")])])]),e("p",[s._v("注意：web 服务不会等待 redis db 「完全启动」之后才启动。")]),s._v(" "),e("h3",{attrs:{id:"dns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dns","aria-hidden":"true"}},[s._v("#")]),s._v(" dns")]),s._v(" "),e("p",[s._v("自定义 DNS 服务器。可以是一个值，也可以是一个列表。")]),s._v(" "),e("div",{staticClass:"language-ldif extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("dns: 8.8.8.8\n\ndns:\n  - 8.8.8.8\n  - 114.114.114.114\n")])])]),e("h3",{attrs:{id:"dns-search"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dns-search","aria-hidden":"true"}},[s._v("#")]),s._v(" dns_search")]),s._v(" "),e("p",[s._v("配置 DNS 搜索域。可以是一个值，也可以是一个列表。")]),s._v(" "),e("div",{staticClass:"language-ldif extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("dns_search: example.com\n\ndns_search:\n  - domain1.example.com\n  - domain2.example.com\n")])])]),e("h3",{attrs:{id:"tmpfs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tmpfs","aria-hidden":"true"}},[s._v("#")]),s._v(" tmpfs")]),s._v(" "),e("p",[s._v("挂载一个 tmpfs 文件系统到容器。")]),s._v(" "),e("div",{staticClass:"language-dockerfile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tmpfs: /run\ntmpfs:\n  - /run\n  - /tmp\n")])])]),e("h3",{attrs:{id:"env-file"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#env-file","aria-hidden":"true"}},[s._v("#")]),s._v(" env_file")]),s._v(" "),e("p",[s._v("从文件中获取环境变量，可以为单独的文件路径或列表。")]),s._v(" "),e("p",[s._v("如果通过 docker-compose -f FILE 方式来指定 Compose 模板文件，则 env_file 中变量的路径会基于模板文件路径。")]),s._v(" "),e("p",[s._v("如果有变量名称与 environment 指令冲突，则按照惯例，以后者为准。")]),s._v(" "),e("div",{staticClass:"language-http extra-class"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("env_file:")]),s._v(" .env\n\nenv_file:\n  - ./common.env\n  - ./apps/web.env\n  - /opt/secrets.env\n")])])]),e("p",[s._v("环境变量文件中每一行必须符合格式，支持 # 开头的注释行。")]),s._v(" "),e("div",{staticClass:"language-makefile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-makefile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# common.env: Set development environment")]),s._v("\nPROG_ENV"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("development\n")])])]),e("h3",{attrs:{id:"environment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#environment","aria-hidden":"true"}},[s._v("#")]),s._v(" environment")]),s._v(" "),e("p",[s._v("设置环境变量。你可以使用数组或字典两种格式。")]),s._v(" "),e("p",[s._v("只给定名称的变量会自动获取运行 Compose 主机上对应变量的值，可以用来防止泄露不必要的数据。")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("RACK_ENV")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" development\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("SESSION_SECRET")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" RACK_ENV=development\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" SESSION_SECRET\n")])])]),e("p",[s._v("如果变量名称或者值中用到 true|false，yes|no 等表达 布尔 含义的词汇，最好放到引号里，避免 YAML 自动解析某些内容为对应的布尔语义。这些特定词汇，包括")]),s._v(" "),e("p",[s._v("y|Y|yes|Yes|YES|n|N|no|No|NO|true|True|TRUE|false|False|FALSE|on|On|ON|off|Off|OFF")]),s._v(" "),e("h3",{attrs:{id:"expose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expose","aria-hidden":"true"}},[s._v("#")]),s._v(" expose")]),s._v(" "),e("p",[s._v("暴露端口，但不映射到宿主机，只被连接的服务访问。")]),s._v(" "),e("p",[s._v("仅可以指定内部端口为参数")]),s._v(" "),e("div",{staticClass:"language-haml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-haml"}},[e("code",[s._v("expose:\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3000"')])]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8000"')])]),s._v("\n")])])]),e("h3",{attrs:{id:"external-links"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#external-links","aria-hidden":"true"}},[s._v("#")]),s._v(" external_links")]),s._v(" "),e("p",[s._v("注意：不建议使用该指令。")]),s._v(" "),e("p",[s._v("链接到 docker-compose.yml 外部的容器，甚至并非 Compose 管理的外部容器。")]),s._v(" "),e("div",{staticClass:"language-haml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-haml"}},[e("code",[s._v("external_links:\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" redis_1")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" project_db_1"),e("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":mysql")])]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" project_db_1"),e("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":postgresql")])]),s._v("\n")])])]),e("h3",{attrs:{id:"extra-hosts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extra-hosts","aria-hidden":"true"}},[s._v("#")]),s._v(" extra_hosts")]),s._v(" "),e("p",[s._v("类似 Docker 中的 --add-host 参数，指定额外的 host 名称映射信息。")]),s._v(" "),e("div",{staticClass:"language-haml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-haml"}},[e("code",[s._v("extra_hosts:\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"googledns:8.8.8.8"')])]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dockerhub:52.1.157.61"')])]),s._v("\n")])])]),e("p",[s._v("会在启动后的服务容器中 /etc/hosts 文件中添加如下两条条目。")]),s._v(" "),e("div",{staticClass:"language-lsl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("8.8.8.8 googledns\n52.1.157.61 dockerhub\n")])])]),e("h3",{attrs:{id:"healthcheck"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#healthcheck","aria-hidden":"true"}},[s._v("#")]),s._v(" healthcheck")]),s._v(" "),e("p",[s._v("通过命令检查容器是否健康运行。")]),s._v(" "),e("div",{staticClass:"language-dts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('healthcheck:\n  test: ["CMD", "curl", "-f", "http://localhost"]\n  interval: 1m30s\n  timeout: 10s\n  retries: 3\n')])])]),e("h3",{attrs:{id:"image"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#image","aria-hidden":"true"}},[s._v("#")]),s._v(" image")]),s._v(" "),e("p",[s._v("指定为镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会尝试拉取这个镜像。")]),s._v(" "),e("p",[s._v("i")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mage: ubuntu\nimage: orchardup/postgresql\nimage: a4bc65fd\n")])])]),e("h3",{attrs:{id:"labels"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#labels","aria-hidden":"true"}},[s._v("#")]),s._v(" labels")]),s._v(" "),e("p",[s._v("为容器添加 Docker 元数据（metadata）信息。例如可以为容器添加辅助说明信息。")]),s._v(" "),e("div",{staticClass:"language-stylus extra-class"},[e("pre",{pre:!0,attrs:{class:"language-stylus"}},[e("code",[s._v("labels"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("startupteam"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("description"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webapp for a startup team"')]),s._v("\n  com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("startupteam"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("department"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devops department"')]),s._v("\n  com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("startupteam"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("release"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rc3 for v1.0"')]),s._v("\n")])])]),e("h3",{attrs:{id:"links"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#links","aria-hidden":"true"}},[s._v("#")]),s._v(" links")]),s._v(" "),e("p",[s._v("注意：不推荐使用该指令。")]),s._v(" "),e("h3",{attrs:{id:"logging"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logging","aria-hidden":"true"}},[s._v("#")]),s._v(" logging")]),s._v(" "),e("p",[s._v("配置日志选项。")]),s._v(" "),e("div",{staticClass:"language-less extra-class"},[e("pre",{pre:!0,attrs:{class:"language-less"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("logging")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("driver")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" syslog\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("options")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("syslog-address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tcp://192.168.0.42:123"')]),s._v("\n")])])]),e("p",[s._v("目前支持三种日志驱动类型。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('driver: "json-file"\ndriver: "syslog"\ndriver: "none"\n')])])]),e("p",[s._v("options 配置日志驱动的相关参数。")]),s._v(" "),e("div",{staticClass:"language-gams extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('options:\n  max-size: "200k"\n  max-file: "10"\n')])])]),e("h3",{attrs:{id:"network-mode"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#network-mode","aria-hidden":"true"}},[s._v("#")]),s._v(" network_mode")]),s._v(" "),e("p",[s._v("设置网络模式。使用和 docker run 的 --network 参数一样的值。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('network_mode: "bridge"\nnetwork_mode: "host"\nnetwork_mode: "none"\nnetwork_mode: "service:[service name]"\nnetwork_mode: "container:[container name/id]"\n')])])]),e("h3",{attrs:{id:"networks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#networks","aria-hidden":"true"}},[s._v("#")]),s._v(" networks")]),s._v(" "),e("p",[s._v("配置容器连接的网络。")]),s._v(" "),e("div",{staticClass:"language-less extra-class"},[e("pre",{pre:!0,attrs:{class:"language-less"}},[e("code",[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("some-service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("networks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" some"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("network\n     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" other"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("network\n\n"),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("networks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("some-network")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v("other-network")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])])]),e("h3",{attrs:{id:"pid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pid","aria-hidden":"true"}},[s._v("#")]),s._v(" pid")]),s._v(" "),e("p",[s._v("跟主机系统共享进程命名空间。打开该选项的容器之间，以及容器和宿主机系统之间可以通过进程 ID 来相互访问和操作。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('pid: "host"\n')])])]),e("h3",{attrs:{id:"ports"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ports","aria-hidden":"true"}},[s._v("#")]),s._v(" ports")]),s._v(" "),e("p",[s._v("暴露端口信息。")]),s._v(" "),e("p",[s._v("使用宿主端口：容器端口 (HOST:CONTAINER) 格式，或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。")]),s._v(" "),e("div",{staticClass:"language-haml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-haml"}},[e("code",[s._v("ports:\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3000"')])]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8000:8000"')])]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"49100:22"')])]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:8001:8001"')])]),s._v("\n")])])]),e("p",[s._v("注意：当使用 HOST:CONTAINER 格式来映射端口时，如果你使用的容器端口小于 60 并且没放到引号里，可能会得到错误结果，因为 YAML 会自动解析 xx:yy 这种数字格式为 60 进制。为避免出现这种问题，建议数字串都采用引号包括起来的字符串格式。")]),s._v(" "),e("h3",{attrs:{id:"secrets"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#secrets","aria-hidden":"true"}},[s._v("#")]),s._v(" secrets")]),s._v(" "),e("p",[s._v("存储敏感数据，例如 mysql 服务密码。")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_ROOT_PASSWORD_FILE")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /run/secrets/db_root_password\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secrets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" db_root_password\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" my_other_secret\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secrets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("my_secret")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./my_secret.txt\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("my_other_secret")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])])]),e("h3",{attrs:{id:"security-opt"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#security-opt","aria-hidden":"true"}},[s._v("#")]),s._v(" security_opt")]),s._v(" "),e("p",[s._v("指定容器模板标签（label）机制的默认属性（用户、角色、类型、级别等）。例如配置标签的用户名和角色名。")]),s._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[s._v("security_opt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" label"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("user"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("USER\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" label"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("role"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ROLE\n")])])]),e("h3",{attrs:{id:"stop-signal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#stop-signal","aria-hidden":"true"}},[s._v("#")]),s._v(" stop_signal")]),s._v(" "),e("p",[s._v("设置另一个信号来停止容器。在默认情况下使用的是 SIGTERM 停止容器。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("stop_signal: SIGUSR1\n")])])]),e("h3",{attrs:{id:"sysctls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sysctls","aria-hidden":"true"}},[s._v("#")]),s._v(" sysctls")]),s._v(" "),e("p",[s._v("配置容器内核参数。")]),s._v(" "),e("div",{staticClass:"language-stylus extra-class"},[e("pre",{pre:!0,attrs:{class:"language-stylus"}},[e("code",[s._v("sysctls"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  net"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("somaxconn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1024\n  net"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tcp_syncookies"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0\n\nsysctls"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property-declaration"}},[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("-")]),s._v(" net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("core"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("somaxconn"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property-declaration"}},[e("span",{pre:!0,attrs:{class:"token property"}},[s._v("-")]),s._v(" net"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("ipv4"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("tcp_syncookies"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")])]),s._v("\n")])])]),e("h3",{attrs:{id:"ulimits"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ulimits","aria-hidden":"true"}},[s._v("#")]),s._v(" ulimits")]),s._v(" "),e("p",[s._v("指定容器的 ulimits 限制值。")]),s._v(" "),e("p",[s._v("例如，指定最大进程数为 65535，指定文件句柄数为 20000（软限制，应用可以随时修改，不能超过硬限制） 和 40000（系统硬限制，只能 root 用户提高）。")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[s._v("  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ulimits")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nproc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nofile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("soft")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hard")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("40000")]),s._v("\n")])])]),e("h3",{attrs:{id:"volumes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#volumes","aria-hidden":"true"}},[s._v("#")]),s._v(" volumes")]),s._v(" "),e("p",[s._v("数据卷所挂载路径设置。可以设置宿主机路径 （HOST:CONTAINER） 或加上访问模式 （HOST:CONTAINER:ro）。")]),s._v(" "),e("p",[s._v("该指令中路径支持相对路径。")]),s._v(" "),e("div",{staticClass:"language-haml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-haml"}},[e("code",[s._v("volumes:\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" cache"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cache")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token code"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("configs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("configs"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token symbol"}},[s._v(":ro")])]),s._v("\n")])])]),e("h1",{attrs:{id:"其它指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其它指令","aria-hidden":"true"}},[s._v("#")]),s._v(" 其它指令")]),s._v(" "),e("p",[s._v("此外，还有包括 domainname, entrypoint, hostname, ipc, mac_address, privileged, read_only, shm_size, restart, stdin_open, tty, user, working_dir 等指令，基本跟 docker run 中对应参数的功能一致。")]),s._v(" "),e("p",[s._v("指定服务容器启动后执行的入口文件。")]),s._v(" "),e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[s._v("entrypoint"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string regex"}},[s._v("/code/")]),s._v("entrypoint"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("sh\n")])])]),e("p",[s._v("指定容器中运行应用的用户名。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("user: nginx\n")])])]),e("p",[s._v("指定容器中工作目录。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("working_dir: /code\n")])])]),e("p",[s._v("指定容器中搜索域名、主机名、mac 地址等。")]),s._v(" "),e("div",{staticClass:"language-subunit extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("domainname: your_website.com\nhostname: test\nmac_address: 08-00-27-00-0C-0A\n")])])]),e("p",[s._v("允许容器中运行一些特权命令。")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])])]),e("p",[s._v("指定容器退出后的重启策略为始终重启。该命令对保持服务始终运行十分有效，在生产环境中推荐配置为 always 或者 unless-stopped。")]),s._v(" "),e("div",{staticClass:"language-avrasm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("restart: always\n")])])]),e("p",[s._v("以只读模式挂载容器的 root 文件系统，意味着不能对容器内容进行修改。")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("read_only")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])])]),e("p",[s._v("打开标准输入，可以接受外部输入。")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stdin_open")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])])]),e("p",[s._v("模拟一个伪终端。")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tty")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])])]),e("h3",{attrs:{id:"读取变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#读取变量","aria-hidden":"true"}},[s._v("#")]),s._v(" 读取变量")]),s._v(" "),e("p",[s._v("Compose 模板文件支持动态读取主机的系统环境变量和当前目录下的 .env 文件中的变量。")]),s._v(" "),e("p",[s._v("例如，下面的 Compose 文件将从运行它的环境中读取变量 ${MONGO_VERSION} 的值，并写入执行的指令中。")]),s._v(" "),e("div",{staticClass:"language-dts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('version: "3"\nservices:\n\ndb:\n  image: "mongo:${MONGO_VERSION}"\n')])])]),e("p",[s._v("如果执行 MONGO_VERSION=3.2 docker-compose up 则会启动一个 mongo:3.2 镜像的容器；如果执行 MONGO_VERSION=2.8 docker-compose up 则会启动一个 mongo:2.8 镜像的容器。")]),s._v(" "),e("p",[s._v("若当前目录存在 .env 文件，执行 docker-compose 命令时将从该文件中读取变量。")]),s._v(" "),e("p",[s._v("在当前目录新建 .env 文件并写入以下内容。")]),s._v(" "),e("div",{staticClass:"language-makefile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-makefile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支持 # 号注释")]),s._v("\nMONGO_VERSION"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("3.6\n")])])]),e("p",[s._v("执行 docker-compose up 则会启动一个 mongo:3.6 镜像的容器。")]),s._v(" "),e("h2",{attrs:{id:"_6-docker-compose-实战"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-docker-compose-实战","aria-hidden":"true"}},[s._v("#")]),s._v(" 6. docker-compose 实战")]),s._v(" "),e("h3",{attrs:{id:"docker-compose-mysql5-7-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-mysql5-7-yml","aria-hidden":"true"}},[s._v("#")]),s._v(" docker-compose-mysql5.7.yml")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.1'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5.7.22\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 3306"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3308")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("TZ")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Asia/Shanghai\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_ROOT_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("character"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("set"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4_general_ci\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("explicit_defaults_for_timestamp=true\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lower_case_table_names=1\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("max_allowed_packet=128M\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sql"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('mode="STRICT_TRANS_TABLES'),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("NO_AUTO_CREATE_USER"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("NO_ENGINE_SUBSTITUTION"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("NO_ZERO_DATE"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("NO_ZERO_IN_DATE"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('ERROR_FOR_DIVISION_BY_ZERO"\n    '),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/mysql\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql-data")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])])]),e("h3",{attrs:{id:"docker-compose-mysql5-8-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-mysql5-8-yml","aria-hidden":"true"}},[s._v("#")]),s._v(" docker-compose-mysql5.8.yml")]),s._v(" "),e("div",{staticClass:"language-YAML extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.1'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MYSQL_ROOT_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("default"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("authentication"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("plugin=mysql_native_password\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("character"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("set"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("collation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server=utf8mb4_general_ci\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("explicit_defaults_for_timestamp=true\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lower_case_table_names=1\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 3306"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3309")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/mysql\n\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("adminer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" adminer\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8080"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])])])])}],r=a(1),n=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},e,!1,null,null,null);t.default=n.exports}}]);